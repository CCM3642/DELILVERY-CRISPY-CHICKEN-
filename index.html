<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7931e;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: transparent;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            white-space: nowrap;
        }
        
        .table tbody tr:hover {
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
            max-width: 350px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .branch-badge {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-normal {
            background-color: var(--success-color);
            color: white;
        }
        
        .offer-chicken {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .offer-ultimate {
            background-color: var(--danger-color);
            color: white;
        }
        
        .page-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .page-header h1 {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .page-header .breadcrumb {
            margin-bottom: 0;
            padding: 0;
            background-color: transparent;
        }
        
        .page-header .breadcrumb-item a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .page-header .breadcrumb-item.active {
            color: var(--dark-color);
        }
        
        .save-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .save-saved {
            background-color: var(--success-color);
            color: white;
        }
        
        .save-unsaved {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .save-saving {
            background-color: var(--primary-color);
            color: white;
        }
        
        .data-management-card {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
        }
        
        .auto-save-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .auto-save-toggle .form-check-input {
            margin-right: 0.5rem;
        }
        
        .data-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        
        .data-stats .stat-item {
            text-align: center;
        }
        
        .data-stats .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .data-stats .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .last-saved {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .btn-group .btn {
            border-radius: 0;
        }
        
        .btn-group .btn:first-child {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }
        
        .btn-group .btn:last-child {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        
        .invalid-feedback {
            display: block;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--danger-color);
        }
        
        .alert {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert-dismissible .btn-close {
            padding: 0.25rem 0.5rem;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .chart-legend-item {
            display: flex;
            align-items: center;
            margin: 0 1rem 0.5rem 0;
        }
        
        .chart-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 0.5rem;
        }
        
        .data-card {
            transition: all 0.3s ease;
        }
        
        .data-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .performance-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .performance-high {
            background-color: var(--success-color);
            color: white;
        }
        
        .performance-medium {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .performance-low {
            background-color: var(--danger-color);
            color: white;
        }
        
        .rating-input {
            display: flex;
            gap: 5px;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .rating-input i {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .rating-input i.active {
            color: #ffc107;
        }
        
        .feedback-category {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .category-service {
            background-color: var(--info-color);
            color: white;
        }
        
        .category-food {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-cleanliness {
            background-color: var(--success-color);
            color: white;
        }
        
        .category-other {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .file-drop-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .file-drop-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .file-drop-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.1);
        }
        
        .progress {
            height: 5px;
            margin-bottom: 1rem;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }
        
        .excel-format-info {
            background-color: #e7f3ff;
            border-left: 4px solid var(--info-color);
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .excel-format-info small {
            color: #6c757d;
        }
        
        .feedback-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--info-color);
        }
        
        .feedback-card h6 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .feedback-card p {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }
        
        .feedback-card .feedback-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .category-color-picker {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border: 2px solid #333;
        }
        
        .feedback-list-item {
            background-color: #fff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        .feedback-list-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .feedback-list-item .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-body {
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .feedback-list-item .feedback-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .feedback-list-item .feedback-actions .btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .notification {
                left: 10px;
                right: 10px;
                min-width: auto;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-chicken-drumstick"></i> Crispy Chicken Dashboard</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('dashboard')"><i class="fas fa-chart-line"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('data-entry')"><i class="fas fa-plus-circle"></i> Data Entry</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('management-report')"><i class="fas fa-file-alt"></i> Management Report</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('feedback-management')"><i class="fas fa-comments"></i> Feedback Management</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page-content">
            <div class="page-header">
                <h1>Sales Data Analysis Dashboard</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Dashboard</li>
                    </ol>
                </nav>
            </div>

            <!-- Date Range Selector -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <label for="dateRange" class="form-label">Date Range</label>
                            <div class="input-group">
                                <input type="date" id="startDate" class="form-control" value="2025-10-01" aria-label="Start date">
                                <span class="input-group-text">to</span>
                                <input type="date" id="endDate" class="form-control" value="2025-10-14" aria-label="End date">
                                <button class="btn btn-primary" onclick="updateDashboard()" aria-label="Update dashboard">
                                    <i class="fas fa-sync"></i> Update
                                </button>
                            </div>
                            <div class="form-text">Select the date range for analysis</div>
                        </div>
                        <div class="col-md-4">
                            <label for="branchFilter" class="form-label">Branch Filter</label>
                            <select id="branchFilter" class="form-select" onchange="updateDashboard()" aria-label="Filter by branch">
                                <option value="all">All Branches</option>
                                <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="offerFilter" class="form-label">Offer Filter</label>
                            <select id="offerFilter" class="form-select" onchange="updateDashboard()" aria-label="Filter by offer">
                                <option value="all">All Offers</option>
                                <option value="Normal Day">Normal Day</option>
                                <option value="Chicken Day">Chicken Day</option>
                                <option value="Ultimate">Ultimate</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalSales">0</div>
                        <div class="metric-label">Total Sales (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalTransactions">0</div>
                        <div class="metric-label">Total Transactions</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="avgTransaction">0</div>
                        <div class="metric-label">Avg. Transaction (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="targetAchievement">0%</div>
                        <div class="metric-label">Target Achievement</div>
                    </div>
                </div>
            </div>

            <!-- Tabs for different views -->
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab" aria-selected="false">Performance</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab" aria-selected="false">Trends</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button" role="tab" aria-selected="false">Insights</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab" aria-selected="false">Recommendations</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="offers-tab" data-bs-toggle="tab" data-bs-target="#offers" type="button" role="tab" aria-selected="false">Offers</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="feedback-analysis-tab" data-bs-toggle="tab" data-bs-target="#feedback-analysis" type="button" role="tab" aria-selected="false">Feedback Analysis</button>
                </li>
            </ul>

            <div class="tab-content" id="dashboardTabsContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Sales & Transactions Trend</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="salesTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Sales Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchSalesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Sales Details</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Daily sales details table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dailySalesTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div class="tab-pane fade" id="performance" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Radar</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Ranking</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRankingChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Best Branch</h3>
                                                <div class="branch-badge" id="bestBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Transactions</h3>
                                                <div class="branch-badge" id="highestTransactionsBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Avg. Sale</h3>
                                                <div class="branch-badge" id="highestAvgSaleBranch">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trends Tab -->
                <div class="tab-pane fade" id="trends" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="dailyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Weekly Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="weeklyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Moving Average Analysis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="movingAverageChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Tab -->
                <div class="tab-pane fade" id="insights" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">AI Insights Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Anomaly Detection</h6>
                                    <div id="anomalyDetection">
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"></i> 
                                            <strong>Anomaly Detection:</strong> 
                                            <p id="anomalyText">Analyzing data...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Predictive Analytics</h6>
                                    <div id="predictiveAnalytics">
                                        <div class="alert alert-info">
                                            <i class="fas fa-chart-line"></i> 
                                            <strong>Sales Prediction:</strong> 
                                            <p id="predictionText">Generating prediction...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <h6>Key Findings</h6>
                                    <div id="keyFindings">
                                        <ul class="list-group" id="keyFindingsList">
                                            <!-- Key findings will be populated by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Tab -->
                <div class="tab-pane fade" id="recommendations" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">30-Day Action Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="recommendationsAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations1" aria-expanded="true">
                                            Short-term Actions
                                        </button>
                                    </h2>
                                    <div id="recommendations1" class="accordion-collapse collapse show" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>Increase weekend promotions at Hamdan St branch to handle high traffic</li>
                                                <li>Introduce more family meal packages at Al Barsha branch to increase average transaction value</li>
                                                <li>Optimize Muroor branch operating hours to match customer demand patterns</li>
                                                <li>Add new product sampling activities at Khaldia branch to attract more customers</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations2">
                                            Medium-term Strategy Adjustments
                                        </button>
                                    </h2>
                                    <div id="recommendations2" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>Redistribute target sales indicators for each branch based on sales data</li>
                                                <li>Create specific improvement plans for underperforming branches</li>
                                                <li>Analyze ROI of different offer types and optimize promotion strategy</li>
                                                <li>Evaluate new branch location possibilities to expand market coverage</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations3">
                                            Long-term Development Plans
                                        </button>
                                    </h2>
                                    <div id="recommendations3" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>Develop customer loyalty program to increase retention rate</li>
                                                <li>Consider launching online ordering and delivery services</li>
                                                <li>Explore new product lines to increase revenue sources</li>
                                                <li>Develop brand expansion plan to enter new market areas</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Offers Tab -->
                <div class="tab-pane fade" id="offers" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Offer Management System</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOfferModal" aria-label="Add new offer">
                                <i class="fas fa-plus"></i> Add Offer
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" aria-label="Offers management table">
                                    <thead>
                                        <tr>
                                            <th>Offer Name</th>
                                            <th>Type</th>
                                            <th>Discount</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="offersTable">
                                        <!-- Offers will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback Analysis Tab -->
                <div class="tab-pane fade" id="feedback-analysis" role="tabpanel">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="feedback-summary-card">
                                <div class="metric-value" id="totalFeedback">0</div>
                                <div class="metric-label">Total Feedback</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="feedback-summary-card">
                                <div class="metric-value" id="avgRating">0.0</div>
                                <div class="metric-label">Average Rating</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="feedback-summary-card">
                                <div class="metric-value" id="positiveFeedback">0%</div>
                                <div class="metric-label">Positive Feedback</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Feedback by Category</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Rating Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="ratingDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Recent Feedback</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentFeedbackList">
                                        <!-- Recent feedback will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Entry Page -->
        <div id="data-entry-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Data Entry</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Data Entry</li>
                    </ol>
                </nav>
            </div>

            <!-- Data Management Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Data Management</h5>
                </div>
                <div class="card-body">
                    <div class="data-management-card">
                        <div class="auto-save-toggle">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoSaveToggle" checked>
                                <label class="form-check-label" for="autoSaveToggle">
                                    Auto-save enabled
                                </label>
                            </div>
                            <span id="saveStatus" class="save-status save-saved">Saved</span>
                        </div>
                        
                        <div class="last-saved">
                            Last saved: <span id="lastSavedTime">Never</span>
                        </div>
                        
                        <div class="data-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="salesRecordsCount">0</div>
                                <div class="stat-label">Sales Records</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="offersCount">0</div>
                                <div class="stat-label">Offers</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="feedbackCount">0</div>
                                <div class="stat-label">Feedback</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalDataSize">0 KB</div>
                                <div class="stat-label">Data Size</div>
                            </div>
                        </div>
                        
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="saveData()">
                                <i class="fas fa-save"></i> Save Data
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="exportData()">
                                <i class="fas fa-download"></i> Export Backup
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="showImportModal()">
                                <i class="fas fa-upload"></i> Import Data
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="clearAllData()">
                                <i class="fas fa-trash-alt"></i> Clear All Data
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetToSample()">
                                <i class="fas fa-undo"></i> Reset to Sample
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-sm btn-outline-secondary" onclick="undoLastAction()">
                                <i class="fas fa-undo"></i> Undo Last Action
                            </button>
                            <span class="ms-2 text-muted" id="undoStatus">No actions to undo</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Excel Import Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Excel Import</h5>
                </div>
                <div class="card-body">
                    <div class="excel-upload-section">
                        <h6><i class="fas fa-file-excel"></i> Import Sales Data from Excel</h6>
                        
                        <div class="excel-format-info">
                            <strong>Excel Format Requirements:</strong>
                            <ul class="mb-0">
                                <li>Required columns: Date, Branch, Channel, Transactions, Sales, Offer Type, Offer Status</li>
                                <li>Optional columns: Average per Order (will be calculated if missing), Notes</li>
                                <li>Date format: YYYY-MM-DD</li>
                                <li>Branch names must match exactly: Crispy Chicken-[Branch Name]</li>
                                <li>Channels: Delivery, Dine-in, Takeaway</li>
                                <li>Offer Types: Normal Day, Chicken Day, Ultimate</li>
                                <li>Offer Status: Active, No Offer</li>
                            </ul>
                            <small><a href="#" onclick="downloadExcelTemplate()">Download Excel Template</a></small>
                        </div>
                        
                        <div class="file-drop-area" id="fileDropArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="mb-0">Drag and drop your Excel file here or <a href="#" id="browseLink">browse files</a></p>
                            <input type="file" id="excelFileInput" accept=".xlsx, .xls" class="d-none" aria-label="Select Excel file">
                        </div>
                        
                        <div class="progress d-none" id="importProgress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary d-none" id="importExcelBtn" onclick="processExcelFile()">
                                <i class="fas fa-file-import"></i> Import Excel Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add New Sales Data</h5>
                        </div>
                        <div class="card-body">
                            <form id="salesDataForm" novalidate>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="dateInput" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="dateInput" required aria-describedby="dateInputHelp">
                                        <div class="invalid-feedback" id="dateInputFeedback"></div>
                                        <div id="dateInputHelp" class="form-text">Enter the date of the sales record</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="branchInput" class="form-label">Branch</label>
                                        <select class="form-select" id="branchInput" required aria-describedby="branchInputHelp">
                                            <option value="">Select Branch</option>
                                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                        </select>
                                        <div class="invalid-feedback" id="branchInputFeedback"></div>
                                        <div id="branchInputHelp" class="form-text">Select the branch where the sale occurred</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="channelInput" class="form-label">Channel</label>
                                        <select class="form-select" id="channelInput" required aria-describedby="channelInputHelp">
                                            <option value="">Select Channel</option>
                                            <option value="Delivery">Delivery</option>
                                            <option value="Dine-in">Dine-in</option>
                                            <option value="Takeaway">Takeaway</option>
                                        </select>
                                        <div class="invalid-feedback" id="channelInputFeedback"></div>
                                        <div id="channelInputHelp" class="form-text">Select the sales channel</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="transactionsInput" class="form-label">Transactions</label>
                                        <input type="number" class="form-control" id="transactionsInput" min="0" required aria-describedby="transactionsInputHelp">
                                        <div class="form-text">Enter the number of transactions</div>
                                        <div class="invalid-feedback" id="transactionsInputFeedback"></div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="salesInput" class="form-label">Sales (AED)</label>
                                        <input type="number" class="form-control" id="salesInput" min="0" step="0.01" required aria-describedby="salesInputHelp">
                                        <div class="form-text">Enter the total sales amount in AED</div>
                                        <div class="invalid-feedback" id="salesInputFeedback"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="averageInput" class="form-label">Average per Order</label>
                                        <input type="number" class="form-control" id="averageInput" min="0" step="0.01" readonly aria-describedby="averageInputHelp">
                                        <div class="form-text">Calculated automatically</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="offerTypeInput" class="form-label">Offer Type</label>
                                        <select class="form-select" id="offerTypeInput" required aria-describedby="offerTypeInputHelp">
                                            <option value="">Select Offer Type</option>
                                            <option value="Normal Day">Normal Day</option>
                                            <option value="Chicken Day">Chicken Day</option>
                                            <option value="Ultimate">Ultimate</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerTypeInputFeedback"></div>
                                        <div id="offerTypeInputHelp" class="form-text">Select the offer type in effect</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="offerStatusInput" class="form-label">Offer Status</label>
                                        <select class="form-select" id="offerStatusInput" required aria-describedby="offerStatusInputHelp">
                                            <option value="">Select Status</option>
                                            <option value="Active">Active</option>
                                            <option value="No Offer">No Offer</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerStatusInputFeedback"></div>
                                        <div id="offerStatusInputHelp" class="form-text">Select if the offer was active</div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="notesInput" class="form-label">Notes</label>
                                    <textarea class="form-control" id="notesInput" rows="2" placeholder="Additional notes (optional)" aria-describedby="notesInputHelp"></textarea>
                                    <div id="notesInputHelp" class="form-text">Optional notes about the sales record</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Save Data
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add Customer Feedback</h5>
                        </div>
                        <div class="card-body">
                            <form id="feedbackForm" novalidate>
                                <div class="mb-3">
                                    <label for="feedbackDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="feedbackDate" required aria-describedby="feedbackDateHelp">
                                    <div class="invalid-feedback" id="feedbackDateFeedback"></div>
                                    <div id="feedbackDateHelp" class="form-text">Enter the date of the feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackBranch" class="form-label">Branch</label>
                                    <select class="form-select" id="feedbackBranch" required aria-describedby="feedbackBranchHelp">
                                        <option value="">Select Branch</option>
                                        <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                        <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                        <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                        <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                        <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                        <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                        <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackBranchFeedback"></div>
                                    <div id="feedbackBranchHelp" class="form-text">Select the branch where the feedback was received</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Rating</label>
                                    <div class="rating-input" id="feedbackRating" role="radiogroup" aria-label="Rating">
                                        <i class="fas fa-star" data-rating="1" role="radio" tabindex="0" aria-label="1 star"></i>
                                        <i class="fas fa-star" data-rating="2" role="radio" tabindex="0" aria-label="2 stars"></i>
                                        <i class="fas fa-star" data-rating="3" role="radio" tabindex="0" aria-label="3 stars"></i>
                                        <i class="fas fa-star" data-rating="4" role="radio" tabindex="0" aria-label="4 stars"></i>
                                        <i class="fas fa-star" data-rating="5" role="radio" tabindex="0" aria-label="5 stars"></i>
                                    </div>
                                    <input type="hidden" id="feedbackRatingValue" value="0" aria-required="true">
                                    <div class="invalid-feedback" id="feedbackRatingFeedback"></div>
                                    <div class="form-text">Select a rating from 1 to 5 stars</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackCategory" class="form-label">Category</label>
                                    <select class="form-select" id="feedbackCategory" required aria-describedby="feedbackCategoryHelp">
                                        <option value="">Select Category</option>
                                        <option value="Service">Service</option>
                                        <option value="Food">Food</option>
                                        <option value="Cleanliness">Cleanliness</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackCategoryFeedback"></div>
                                    <div id="feedbackCategoryHelp" class="form-text">Select the category of feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackComment" class="form-label">Comment</label>
                                    <textarea class="form-control" id="feedbackComment" rows="3" required placeholder="Please share your experience..." aria-describedby="feedbackCommentHelp"></textarea>
                                    <div class="invalid-feedback" id="feedbackCommentFeedback"></div>
                                    <div id="feedbackCommentHelp" class="form-text">Please provide detailed feedback about your experience</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Submit Feedback
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Data Records</h5>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="dataTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="sales-tab" data-bs-toggle="tab" data-bs-target="#sales" type="button" role="tab" aria-selected="true">Sales Data</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="feedback-tab" data-bs-toggle="tab" data-bs-target="#feedback" type="button" role="tab" aria-selected="false">Customer Feedback</button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="dataTabsContent">
                                <div class="tab-pane fade show active" id="sales" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Sales data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="feedback" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Feedback data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Rating</th>
                                                    <th>Category</th>
                                                    <th>Comment</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="feedbackTable">
                                                <!-- Feedback table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Management Report Page -->
        <div id="management-report-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Management Report</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Management Report</li>
                    </ol>
                </nav>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Executive Summary</h5>
                </div>
                <div class="card-body">
                    <p>This report analyzes Crispy Chicken's sales data from October 1-14, 2025. During this period, the company achieved total sales of <span id="reportTotalSales">0</span> AED with <span id="reportTotalTransactions">0</span> transactions completed. The average transaction value was <span id="reportAvgTransaction">0</span> AED. Overall, the company performed well during this period, with particularly strong performance from the Hamdan St and Khaldia branches.</p>
                    <p>During the reporting period, we observed that weekend sales were significantly higher than weekdays, indicating that our marketing activities are more effective on weekends. Additionally, the Ultimate offer type had the highest conversion rate, suggesting we should promote more of these offers in the future.</p>
                </div>
            </div>

            <!-- Monthly Summary Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Monthly Summary</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" aria-label="Monthly summary table">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Branch</th>
                                    <th>Total Orders</th>
                                    <th>Total Sales (AED)</th>
                                    <th>Average Order (AED)</th>
                                    <th>Growth vs Last Month (%)</th>
                                    <th>Growth vs Last Year (%)</th>
                                    <th>Best Day</th>
                                </tr>
                            </thead>
                            <tbody id="monthlySummaryTable">
                                <!-- Table content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Branch Performance Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="branchPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul>
                                    <li>Hamdan St branch has the highest sales, accounting for 35% of total sales</li>
                                    <li>Al Barsha branch has fewer transactions but the highest average transaction value</li>
                                    <li>Al Satwa branch performs particularly well on weekends but relatively weak on weekdays</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Daily & Weekly Performance</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="dailyWeeklyPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul>
                                    <li>Saturday and Sunday are peak sales days, with 40% higher transaction volume than weekdays</li>
                                    <li>Week 1 (Oct 1-7) had slightly higher sales than Week 2</li>
                                    <li>Wednesday is typically the lowest transaction day of the week</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Monthly Trend Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul>
                                    <li>Beginning and end of month typically show better sales performance</li>
                                    <li>Middle of month has higher sales volatility, requiring further analysis</li>
                                    <li>Overall sales show an upward trend with 12% month-over-month growth</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target Distribution Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="targetPlanChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Target Distribution Recommendations:</h6>
                                <ul>
                                    <li>Hamdan St branch: 35% target share (based on historical performance)</li>
                                    <li>Khaldia branch: 25% target share (based on traffic analysis)</li>
                                    <li>Al Barsha branch: 20% target share (based on average transaction value)</li>
                                    <li>Other branches: 20% target share (based on growth potential)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Customer Feedback Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportTotalFeedback">0</h3>
                                <p>Total Feedback</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportAvgRating">0.0</h3>
                                <p>Average Rating</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportPositiveFeedback">0%</h3>
                                <p>Positive Feedback (4-5 stars)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Top Feedback Categories</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackCategoryReportChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackRatingReportChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Feedback Insights</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            <strong>Key Feedback Insights:</strong> 
                            <ul>
                                <li>Service quality is consistently rated highest across all branches</li>
                                <li>Food quality shows room for improvement, particularly in Al Barsha branch</li>
                                <li>Customers appreciate cleanliness but suggest faster service during peak hours</li>
                                <li>Ultimate offer receives the most positive customer feedback</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Management Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>Short-term Recommendations</h6>
                            <ul>
                                <li>Increase weekend promotions at Hamdan St branch to handle high traffic</li>
                                <li>Introduce more family meal packages at Al Barsha branch to increase average transaction value</li>
                                <li>Optimize Muroor branch operating hours to match customer demand patterns</li>
                                <li>Add new product sampling activities at Khaldia branch to attract more customers</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Medium-term Strategy Adjustments</h6>
                            <ul>
                                <li>Redistribute target sales indicators for each branch based on sales data</li>
                                <li>Create specific improvement plans for underperforming branches</li>
                                <li>Analyze ROI of different offer types and optimize promotion strategy</li>
                                <li>Evaluate new branch location possibilities to expand market coverage</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Long-term Development Plans</h6>
                            <ul>
                                <li>Develop customer loyalty program to increase retention rate</li>
                                <li>Consider launching online ordering and delivery services</li>
                                <li>Explore new product lines to increase revenue sources</li>
                                <li>Develop brand expansion plan to enter new market areas</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Management Page -->
        <div id="feedback-management-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Customer Feedback Management</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Feedback Management</li>
                    </ol>
                </nav>
            </div>

            <!-- Feedback Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackTotal">0</div>
                        <div class="metric-label">Total Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackAvgRating">0.0</div>
                        <div class="metric-label">Average Rating</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackPositive">0%</div>
                        <div class="metric-label">Positive Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackNegative">0%</div>
                        <div class="metric-label">Negative Feedback</div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Feedback Management Tabs -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Feedback Management</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="feedbackManagementTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="feedback-overview-tab" data-bs-toggle="tab" data-bs-target="#feedback-overview" type="button" role="tab" aria-selected="true">Overview</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-branch-tab" data-bs-toggle="tab" data-bs-target="#feedback-branch" type="button" role="tab" aria-selected="false">Branch Performance</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-category-tab" data-bs-toggle="tab" data-bs-target="#feedback-category" type="button" role="tab" aria-selected="false">Category Management</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-list-tab" data-bs-toggle="tab" data-bs-target="#feedback-list" type="button" role="tab" aria-selected="false">Feedback List</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="feedbackManagementTabsContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="feedback-overview" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Feedback by Category</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewCategoryChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Rating Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewRatingChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Branch Performance Tab -->
                        <div class="tab-pane fade" id="feedback-branch" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Overview</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackBranchPerformanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Branch performance metrics table">
                                            <thead>
                                                <tr>
                                                    <th>Branch</th>
                                                    <th>Total Feedback</th>
                                                    <th>Average Rating</th>
                                                    <th>Positive Feedback</th>
                                                    <th>Negative Feedback</th>
                                                    <th>Most Common Category</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="branchPerformanceTable">
                                                <!-- Branch performance data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Management Tab -->
                        <div class="tab-pane fade" id="feedback-category" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Category Management</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Add New Category</h6>
                                            <form id="addCategoryForm">
                                                <div class="mb-3">
                                                    <label for="newCategoryName" class="form-label">Category Name</label>
                                                    <input type="text" class="form-control" id="newCategoryName" required aria-describedby="newCategoryNameHelp">
                                                    <div class="form-text">Enter a unique category name</div>
                                                    <div class="invalid-feedback" id="newCategoryNameFeedback"></div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Category Color</label>
                                                    <div class="category-color-picker" id="categoryColorPicker">
                                                        <div class="color-option" style="background-color: #17a2b8;" data-color="#17a2b8" role="button" tabindex="0" aria-label="Blue color"></div>
                                                        <div class="color-option" style="background-color: #ff6b35;" data-color="#ff6b35" role="button" tabindex="0" aria-label="Orange color"></div>
                                                        <div class="color-option" style="background-color: #28a745;" data-color="#28a745" role="button" tabindex="0" aria-label="Green color"></div>
                                                        <div class="color-option" style="background-color: #ffc107;" data-color="#ffc107" role="button" tabindex="0" aria-label="Yellow color"></div>
                                                        <div class="color-option" style="background-color: #dc3545;" data-color="#dc3545" role="button" tabindex="0" aria-label="Red color"></div>
                                                        <div class="color-option" style="background-color: #6f42c1;" data-color="#6f42c1" role="button" tabindex="0" aria-label="Purple color"></div>
                                                    </div>
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary w-100">
                                                    <i class="fas fa-plus"></i> Add Category
                                                </button>
                                            </form>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <h6>Existing Categories</h6>
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Category</th>
                                                            <th>Count</th>
                                                            <th>Avg Rating</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="existingCategoriesTable">
                                                        <!-- Existing categories will be populated by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Category Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive category-performance-table">
                                        <table class="table table-hover" aria-label="Category performance metrics table">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Total Feedback</th>
                                                    <th>Average Rating</th>
                                                    <th>Positive Feedback</th>
                                                    <th>Negative Feedback</th>
                                                    <th>Trend</th>
                                                </tr>
                                            </thead>
                                            <tbody id="categoryPerformanceTable">
                                                <!-- Category performance data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Feedback List Tab -->
                        <div class="tab-pane fade" id="feedback-list" role="tabpanel">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Customer Feedback</h5>
                                    <div>
                                        <select class="form-select form-select-sm me-2" id="feedbackFilterBranch" onchange="updateFeedbackList()" aria-label="Filter by branch">
                                            <option value="all">All Branches</option>
                                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                        </select>
                                        <select class="form-select form-select-sm me-2" id="feedbackFilterCategory" onchange="updateFeedbackList()" aria-label="Filter by category">
                                            <option value="all">All Categories</option>
                                            <option value="Service">Service</option>
                                            <option value="Food">Food</option>
                                            <option value="Cleanliness">Cleanliness</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        <select class="form-select form-select-sm" id="feedbackFilterRating" onchange="updateFeedbackList()" aria-label="Filter by rating">
                                            <option value="all">All Ratings</option>
                                            <option value="5">5 Stars</option>
                                            <option value="4">4 Stars</option>
                                            <option value="3">3 Stars</option>
                                            <option value="2">2 Stars</option>
                                            <option value="1">1 Star</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="feedbackList">
                                        <!-- Feedback cards will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Add Offer Modal -->
    <div class="modal fade" id="addOfferModal" tabindex="-1" aria-labelledby="addOfferModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOfferModalLabel">Add New Offer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="offerForm" novalidate>
                        <div class="mb-3">
                            <label for="offerName" class="form-label">Offer Name</label>
                            <input type="text" class="form-control" id="offerName" required aria-describedby="offerNameHelp">
                            <div class="invalid-feedback" id="offerNameFeedback"></div>
                            <div id="offerNameHelp" class="form-text">Enter a descriptive name for the offer</div>
                        </div>
                        <div class="mb-3">
                            <label for="offerType" class="form-label">Offer Type</label>
                            <select class="form-select" id="offerType" required aria-describedby="offerTypeHelp">
                                <option value="">Select Offer Type</option>
                                <option value="Normal Day">Normal Day</option>
                                <option value="Chicken Day">Chicken Day</option>
                                <option value="Ultimate">Ultimate</option>
                            </select>
                            <div class="invalid-feedback" id="offerTypeFeedback"></div>
                            <div id="offerTypeHelp" class="form-text">Select the type of offer</div>
                        </div>
                        <div class="mb-3">
                            <label for="offerDiscount" class="form-label">Discount (%)</label>
                            <input type="number" class="form-control" id="offerDiscount" min="0" max="100" required aria-describedby="offerDiscountHelp">
                            <div class="form-text">Enter discount percentage (0-100)</div>
                            <div class="invalid-feedback" id="offerDiscountFeedback"></div>
                            <div id="offerDiscountHelp" class="form-text">Enter the discount percentage for this offer</div>
                        </div>
                        <div class="mb-3">
                            <label for="offerStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="offerStartDate" required aria-describedby="offerStartDateHelp">
                            <div class="invalid-feedback" id="offerStartDateFeedback"></div>
                            <div id="offerStartDateHelp" class="form-text">Select when the offer becomes active</div>
                        </div>
                        <div class="mb-3">
                            <label for="offerEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="offerEndDate" required aria-describedby="offerEndDateHelp">
                            <div class="invalid-feedback" id="offerEndDateFeedback"></div>
                            <div id="offerEndDateHelp" class="form-text">Select when the offer expires</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveOfferButton">Save Offer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal fade" id="importDataModal" tabindex="-1" aria-labelledby="importDataModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importDataModalLabel">Import Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="importType" class="form-label">Import Type</label>
                        <select class="form-select" id="importType" aria-describedby="importTypeHelp">
                            <option value="json">JSON File</option>
                            <option value="excel">Excel File</option>
                        </select>
                        <div id="importTypeHelp" class="form-text">Select the type of file to import</div>
                    </div>
                    
                    <div id="jsonImportSection">
                        <div class="mb-3">
                            <label for="importFile" class="form-label">Select JSON File</label>
                            <input type="file" class="form-control" id="importFile" accept=".json" aria-describedby="jsonFileHelp">
                            <div id="jsonFileHelp" class="form-text">Select a JSON backup file to import</div>
                        </div>
                    </div>
                    
                    <div id="excelImportSection" style="display: none;">
                        <div class="mb-3">
                            <label for="excelImportFile" class="form-label">Select Excel File</label>
                            <input type="file" class="form-control" id="excelImportFile" accept=".xlsx, .xls" aria-describedby="excelFileHelp">
                            <div id="excelFileHelp" class="form-text">Select an Excel file to import</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="mergeData">
                            <label class="form-check-label" for="mergeData">
                                Merge with existing data
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmImportBtn">Import Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" aria-live="polite" aria-atomic="true"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;" role="alert" aria-busy="true">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS for Excel import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Configuration constants
        const CONFIG = {
            TARGET_SALES: 50000,
            AUTO_SAVE_INTERVAL: 30000,
            DATE_FORMAT: 'YYYY-MM-DD',
            MAX_DATA_SIZE: 5 * 1024 * 1024, // 5MB
            BRANCHES: [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ],
            CHANNELS: ['Delivery', 'Dine-in', 'Takeaway'],
            OFFER_TYPES: ['Normal Day', 'Chicken Day', 'Ultimate'],
            DAYS_OF_WEEK: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
            FEEDBACK_CATEGORIES: ['Service', 'Food', 'Cleanliness', 'Other'],
            FEEDBACK_STATUSES: ['New', 'In Progress', 'Resolved'],
            CATEGORY_COLORS: {
                'Service': '#17a2b8',
                'Food': '#ff6b35',
                'Cleanliness': '#28a745',
                'Other': '#ffc107'
            }
        };

        // Data history for undo functionality
        const dataHistory = [];
        const MAX_HISTORY_SIZE = 10;

        // Sample data initialization
        let salesData = [
            { id: 1, date: '2025-10-01', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 73, sales: 3216, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 2, date: '2025-10-01', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 38, sales: 1859.8, averagePerOrder: 49, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 3, date: '2025-10-01', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 39, sales: 1965, averagePerOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 4, date: '2025-10-01', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 42, sales: 2024, averagePerOrder: 48, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 5, date: '2025-10-01', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 24, sales: 1376, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 6, date: '2025-10-01', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 387, averagePerOrder: 35, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 7, date: '2025-10-01', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 5, sales: 204, averagePerOrder: 41, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 8, date: '2025-10-02', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 62, sales: 3238, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 9, date: '2025-10-02', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 28, sales: 1492, averagePerOrder: 53, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 10, date: '2025-10-02', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 44, sales: 2057, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 11, date: '2025-10-02', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 40, sales: 1945, averagePerOrder: 49, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 12, date: '2025-10-02', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 30, sales: 1644, averagePerOrder: 55, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 13, date: '2025-10-02', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 10, sales: 527, averagePerOrder: 53, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 14, date: '2025-10-02', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 15, sales: 761, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 15, date: '2025-10-03', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 72, sales: 4287, averagePerOrder: 60, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 16, date: '2025-10-03', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 46, sales: 2930, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 17, date: '2025-10-03', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 40, sales: 1828, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 18, date: '2025-10-03', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 32, sales: 1617, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 19, date: '2025-10-03', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 29, sales: 1127, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 20, date: '2025-10-03', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 427, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 21, date: '2025-10-03', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 10, sales: 475, averagePerOrder: 48, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 22, date: '2025-10-04', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 84, sales: 4833, averagePerOrder: 58, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 23, date: '2025-10-04', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 43, sales: 2400, averagePerOrder: 56, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 24, date: '2025-10-04', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 31, sales: 1447, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 25, date: '2025-10-04', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 36, sales: 2299, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 26, date: '2025-10-04', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 20, sales: 936, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 27, date: '2025-10-04', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 566, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 28, date: '2025-10-04', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 15, sales: 554, averagePerOrder: 37, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 29, date: '2025-10-05', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 76, sales: 2921, averagePerOrder: 38, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 30, date: '2025-10-05', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 43, sales: 1982, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 31, date: '2025-10-05', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 29, sales: 1344, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 32, date: '2025-10-05', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 20, sales: 1126, averagePerOrder: 56, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 33, date: '2025-10-05', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 25, sales: 1089.9, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 34, date: '2025-10-05', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 13, sales: 462, averagePerOrder: 36, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 35, date: '2025-10-05', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 8, sales: 241, averagePerOrder: 30, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 36, date: '2025-10-06', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 101, sales: 4363, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 37, date: '2025-10-06', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 54, sales: 2113, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 38, date: '2025-10-06', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 61, sales: 2714.8, averagePerOrder: 45, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 39, date: '2025-10-06', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 47, sales: 2124, averagePerOrder: 45, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 40, date: '2025-10-06', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 57, sales: 4201, averagePerOrder: 74, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 41, date: '2025-10-06', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 20, sales: 848, averagePerOrder: 42, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 42, date: '2025-10-06', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 18, sales: 708, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 43, date: '2025-10-07', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 119, sales: 5056, averagePerOrder: 42, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 44, date: '2025-10-07', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 50, sales: 2175, averagePerOrder: 44, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 45, date: '2025-10-07', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 80, sales: 3475, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 46, date: '2025-10-07', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 46, sales: 1957, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 47, date: '2025-10-07', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 44, sales: 2590, averagePerOrder: 59, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 48, date: '2025-10-07', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 18, sales: 705, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 49, date: '2025-10-07', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 19, sales: 823, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
            { id: 50, date: '2025-10-08', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 58, sales: 2568.9, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 51, date: '2025-10-08', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 24, sales: 1037, averagePerOrder: 43, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 52, date: '2025-10-08', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 30, sales: 1574, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 53, date: '2025-10-08', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 30, sales: 1404, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 54, date: '2025-10-08', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 29, sales: 1891, averagePerOrder: 65, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 55, date: '2025-10-08', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 5, sales: 148, averagePerOrder: 30, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 56, date: '2025-10-08', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 8, sales: 476, averagePerOrder: 60, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 57, date: '2025-10-09', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 53, sales: 2738, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 58, date: '2025-10-09', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 31, sales: 2112, averagePerOrder: 68, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 59, date: '2025-10-09', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 35, sales: 1487, averagePerOrder: 42, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 60, date: '2025-10-09', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 35, sales: 1978, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 61, date: '2025-10-09', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 17, sales: 733, averagePerOrder: 43, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 62, date: '2025-10-09', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 5, sales: 184, averagePerOrder: 37, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 63, date: '2025-10-09', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 13, sales: 408, averagePerOrder: 31, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 64, date: '2025-10-10', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 65, sales: 2900, averagePerOrder: 45, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 65, date: '2025-10-10', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 46, sales: 2943, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 66, date: '2025-10-10', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 45, sales: 2411, averagePerOrder: 54, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 67, date: '2025-10-10', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 39, sales: 2261, averagePerOrder: 58, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 68, date: '2025-10-10', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 25, sales: 1523, averagePerOrder: 61, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 69, date: '2025-10-10', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 12, sales: 976, averagePerOrder: 81, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 70, date: '2025-10-10', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 10, sales: 573, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 71, date: '2025-10-11', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 78, sales: 4313, averagePerOrder: 55, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 72, date: '2025-10-11', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 48, sales: 3452, averagePerOrder: 72, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 73, date: '2025-10-11', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 34, sales: 1711, averagePerOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 74, date: '2025-10-11', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 28, sales: 1654, averagePerOrder: 59, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 75, date: '2025-10-11', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 20, sales: 778, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 76, date: '2025-10-11', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 10, sales: 391, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 77, date: '2025-10-11', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 9, sales: 275, averagePerOrder: 31, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
            { id: 78, date: '2025-10-12', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 51, sales: 2146, averagePerOrder: 42, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 79, date: '2025-10-12', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 33, sales: 1802, averagePerOrder: 55, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 80, date: '2025-10-12', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 32, sales: 1331, averagePerOrder: 42, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 81, date: '2025-10-12', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 23, sales: 1195, averagePerOrder: 52, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 82, date: '2025-10-12', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 22, sales: 1233, averagePerOrder: 56, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 83, date: '2025-10-12', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 4, sales: 153, averagePerOrder: 38, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 84, date: '2025-10-12', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 6, sales: 232, averagePerOrder: 39, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 85, date: '2025-10-13', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 113, sales: 4089, averagePerOrder: 36, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 86, date: '2025-10-13', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 57, sales: 2344, averagePerOrder: 41, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 87, date: '2025-10-13', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 77, sales: 3422, averagePerOrder: 44, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 88, date: '2025-10-13', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 42, sales: 1803, averagePerOrder: 43, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 89, date: '2025-10-13', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 46, sales: 2574, averagePerOrder: 56, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 90, date: '2025-10-13', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 18, sales: 657, averagePerOrder: 37, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 91, date: '2025-10-13', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 17, sales: 741, averagePerOrder: 44, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 92, date: '2025-10-14', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 93, date: '2025-10-14', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 94, date: '2025-10-14', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 95, date: '2025-10-14', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 96, date: '2025-10-14', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 97, date: '2025-10-14', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
            { id: 98, date: '2025-10-14', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' }
        ];

        let offers = [
            { id: 1, name: 'Weekend Special', type: 'Normal Day', discount: 15, startDate: '2025-10-01', endDate: '2025-10-31', status: 'Active' },
            { id: 2, name: 'Chicken Fiesta', type: 'Chicken Day', discount: 25, startDate: '2025-10-01', endDate: '2025-10-15', status: 'Active' },
            { id: 3, name: 'Ultimate Combo', type: 'Ultimate', discount: 30, startDate: '2025-10-01', endDate: '2025-10-31', status: 'Active' }
        ];

        // Sample feedback data
        let feedbackData = [
            { id: 1, date: '2025-10-01', branch: 'Crispy Chicken-Hamdan St', rating: 5, comment: 'Great service! The chicken was fresh and delicious.', category: 'Service', status: 'Resolved', response: 'Thank you for your feedback! We\'re glad you enjoyed our service.' },
            { id: 2, date: '2025-10-02', branch: 'Crispy Chicken Khaldia', rating: 4, comment: 'Food was delicious but delivery took longer than expected.', category: 'Food', status: 'In Progress', response: '' },
            { id: 3, date: '2025-10-03', branch: 'Crispy Chicken Shabiya 11', rating: 3, comment: 'The restaurant was clean but the staff seemed overwhelmed.', category: 'Service', status: 'New', response: '' },
            { id: 4, date: '2025-10-04', branch: 'Crispy Chicken Muroor', rating: 5, comment: 'Excellent experience! Will definitely come back.', category: 'Cleanliness', status: 'Resolved', response: 'Thank you for your 5-star rating!' },
            { id: 5, date: '2025-10-05', branch: 'Crispy Chicken Al Barsha', rating: 2, comment: 'The chicken was too dry and not seasoned well.', category: 'Food', status: 'In Progress', response: 'We apologize for the experience. Our team will review this immediately.' },
            { id: 6, date: '2025-10-06', branch: 'Crispy Chicken-Hamdan St', rating: 4, comment: 'Good value for money during the Ultimate offer.', category: 'Food', status: 'Resolved', response: 'Glad you enjoyed our Ultimate offer!' },
            { id: 7, date: '2025-10-07', branch: 'Crispy Chicken Khaldia', rating: 5, comment: 'Best chicken in town! The Ultimate combo is amazing.', category: 'Food', status: 'Resolved', response: 'Thank you for your amazing feedback!' },
            { id: 8, date: '2025-10-08', branch: 'Crispy Chicken Shabiya 11', rating: 3, comment: 'Average experience. Nothing special but not bad either.', category: 'Other', status: 'Resolved', response: 'We appreciate your feedback and will continue to improve.' }
        ];

        // Chart instances
        let chartInstances = {};

        // Auto-save functionality
        let autoSaveInterval;
        let isDataChanged = false;
        let autoSaveEnabled = true;
        let currentEditingOffer = null;
        let excelFile = null;
        let selectedCategoryColor = '#17a2b8';

        // Page navigation
        function showPage(pageName) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            if (pageName === 'dashboard') {
                document.getElementById('dashboard-page').style.display = 'block';
                updateDashboard();
            } else if (pageName === 'data-entry') {
                document.getElementById('data-entry-page').style.display = 'block';
                updateDataTable();
                updateFeedbackTable();
                updateDataStats();
                updateLastSavedTime();
            } else if (pageName === 'management-report') {
                document.getElementById('management-report-page').style.display = 'block';
                updateManagementReport();
            } else if (pageName === 'feedback-management') {
                document.getElementById('feedback-management-page').style.display = 'block';
                updateFeedbackManagement();
            }
        }

        // Initialize auto-save
        function initAutoSave() {
            const autoSaveToggle = document.getElementById('autoSaveToggle');
            autoSaveToggle.addEventListener('change', function() {
                autoSaveEnabled = this.checked;
                if (autoSaveEnabled) {
                    startAutoSave();
                    showNotification('Auto-save enabled', 'success');
                } else {
                    stopAutoSave();
                    showNotification('Auto-save disabled', 'info');
                }
            });
            
            startAutoSave();
        }

        // Start auto-save
        function startAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            autoSaveInterval = setInterval(() => {
                if (autoSaveEnabled && isDataChanged) {
                    saveData();
                }
            }, CONFIG.AUTO_SAVE_INTERVAL);
        }

        // Stop auto-save
        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // Mark data as changed
        function markDataChanged() {
            if (!isDataChanged) {
                isDataChanged = true;
                updateSaveStatus('unsaved');
                saveDataState();
            }
        }

        // Update save status
        function updateSaveStatus(status) {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.className = 'save-status';
            
            switch(status) {
                case 'saved':
                    saveStatus.classList.add('save-saved');
                    saveStatus.textContent = 'Saved';
                    break;
                case 'unsaved':
                    saveStatus.classList.add('save-unsaved');
                    saveStatus.textContent = 'Unsaved';
                    break;
                case 'saving':
                    saveStatus.classList.add('save-saving');
                    saveStatus.textContent = 'Saving...';
                    break;
            }
        }

        // Save data to localStorage
        function saveData() {
            updateSaveStatus('saving');
            
            try {
                const dataToSave = {
                    salesData: salesData,
                    offers: offers,
                    feedbackData: feedbackData,
                    timestamp: new Date().toISOString()
                };
                
                // Validate data size
                const dataSize = JSON.stringify(dataToSave).length;
                if (dataSize > CONFIG.MAX_DATA_SIZE) {
                    showNotification('Data size exceeds maximum limit', 'danger');
                    updateSaveStatus('unsaved');
                    return;
                }
                
                localStorage.setItem('crispyChickenData', JSON.stringify(dataToSave));
                isDataChanged = false;
                updateSaveStatus('saved');
                updateLastSavedTime();
                showNotification('Data saved successfully', 'success');
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Error saving data: ' + error.message, 'danger');
                updateSaveStatus('unsaved');
            }
        }

        // Load data from localStorage
        function loadData() {
            try {
                const savedData = localStorage.getItem('crispyChickenData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Validate loaded data
                    if (!data.salesData || !data.offers || !data.feedbackData) {
                        throw new Error('Invalid data format');
                    }
                    
                    salesData = data.salesData || [];
                    offers = data.offers || [];
                    feedbackData = data.feedbackData || [];
                    
                    // Validate data integrity and add day property if missing
                    salesData = salesData.map(item => {
                        if (!item.day) {
                            return {
                                ...item,
                                day: getDayOfWeek(item.date)
                            };
                        }
                        return item;
                    }).filter(item => {
                        return item.date && item.branch && item.channel && 
                               typeof item.transactions === 'number' && 
                               typeof item.sales === 'number' && 
                               item.offerType && item.offerStatus;
                    });
                    
                    showNotification('Data loaded successfully', 'success');
                    return true;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Error loading data: ' + error.message, 'danger');
            }
            return false;
        }

        // Export data as JSON
        function exportData() {
            try {
                const dataToExport = {
                    salesData: salesData,
                    offers: offers,
                    feedbackData: feedbackData,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'crispy_chicken_backup_' + new Date().toISOString().slice(0,10) + '.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Data exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Error exporting data: ' + error.message, 'danger');
            }
        }

        // Export to PDF
        function exportToPDF() {
            try {
                showLoading();
                
                // Create a new PDF document
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Crispy Chicken Sales Report', 20, 20);
                
                // Add date
                doc.setFontSize(12);
                doc.text('Generated: ' + new Date().toLocaleDateString(), 20, 30);
                
                // Add summary
                const totalSales = salesData.reduce((sum, item) => sum + item.sales, 0);
                const totalTransactions = salesData.reduce((sum, item) => sum + item.transactions, 0);
                const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
                
                doc.text('Total Sales: ' + totalSales.toLocaleString() + ' AED', 20, 50);
                doc.text('Total Transactions: ' + totalTransactions.toLocaleString(), 20, 60);
                doc.text('Average Transaction: ' + avgTransaction.toFixed(2) + ' AED', 20, 70);
                
                // Add branch sales table
                let yPosition = 90;
                doc.setFontSize(14);
                doc.text('Branch Sales Summary', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                // Table headers
                doc.text('Branch', 20, yPosition);
                doc.text('Sales', 80, yPosition);
                doc.text('Transactions', 130, yPosition);
                doc.text('Avg/Order', 180, yPosition);
                yPosition += 10;
                
                // Table data
                const branchSales = {};
                salesData.forEach(item => {
                    if (!branchSales[item.branch]) {
                        branchSales[item.branch] = { sales: 0, transactions: 0 };
                    }
                    branchSales[item.branch].sales += item.sales;
                    branchSales[item.branch].transactions += item.transactions;
                });
                
                Object.keys(branchSales).forEach(branch => {
                    const data = branchSales[branch];
                    const avg = data.transactions > 0 ? (data.sales / data.transactions).toFixed(2) : 0;
                    
                    doc.text(branch, 20, yPosition);
                    doc.text(data.sales.toLocaleString(), 80, yPosition);
                    doc.text(data.transactions.toLocaleString(), 130, yPosition);
                    doc.text(avg, 180, yPosition);
                    yPosition += 10;
                });
                
                // Save the PDF
                doc.save('crispy_chicken_report.pdf');
                showNotification('PDF report generated successfully', 'success');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showNotification('Error generating PDF: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // Import data from JSON
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Please select a file to import', 'warning');
                return;
            }
            
            if (file.size > CONFIG.MAX_DATA_SIZE) {
                showNotification('File size exceeds maximum limit', 'danger');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate imported data
                    if (!importedData.salesData || !importedData.offers || !importedData.feedbackData) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    // Validate data integrity and add day property if missing
                    const validSalesData = importedData.salesData.map(item => {
                        if (!item.day) {
                            item.day = getDayOfWeek(item.date);
                        }
                        return item;
                    }).filter(item => {
                        return item.date && item.branch && item.channel && 
                               typeof item.transactions === 'number' && 
                               typeof item.sales === 'number' && 
                               item.offerType && item.offerStatus;
                    });
                    
                    if (validSalesData.length !== importedData.salesData.length) {
                        showNotification('Some sales records were invalid and were filtered out', 'warning');
                    }
                    
                    salesData = validSalesData;
                    offers = importedData.offers.filter(offer => 
                        offer.id && offer.name && offer.type && 
                        typeof offer.discount === 'number' && 
                        offer.startDate && offer.endDate && offer.status
                    );
                    
                    feedbackData = importedData.feedbackData.filter(feedback => 
                        feedback.id && feedback.date && feedback.branch && 
                        typeof feedback.rating === 'number' && 
                        feedback.category && feedback.comment && feedback.status
                    );
                    
                    updateDataTable();
                    updateFeedbackTable();
                    updateDataStats();
                    updateLastSavedTime();
                    markDataChanged();
                    showNotification('Data imported successfully', 'success');
                } catch (error) {
                    console.error('Error importing data:', error);
                    showNotification('Error importing data: ' + error.message, 'danger');
                }
            };
            
            reader.readAsText(file);
            fileInput.value = '';
        }

        // Import data from Excel
        function importExcelData() {
            const fileInput = document.getElementById('excelImportFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Please select an Excel file to import', 'warning');
                return;
            }
            
            if (file.size > CONFIG.MAX_DATA_SIZE) {
                showNotification('File size exceeds maximum limit', 'danger');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Process Excel data with enhanced validation
                    const processedData = processExcelData(jsonData);
                    
                    if (processedData.length === 0) {
                        showNotification('No valid data found in Excel file', 'warning');
                        return;
                    }
                    
                    // Merge or replace data based on user preference
                    const mergeData = document.getElementById('mergeData').checked;
                    if (mergeData) {
                        salesData = [...salesData, ...processedData];
                        showNotification(`Merged ${processedData.length} records with existing data`, 'success');
                    } else {
                        salesData = processedData;
                        showNotification(`Replaced all data with ${processedData.length} records from Excel`, 'success');
                    }
                    
                    updateDataTable();
                    updateDataStats();
                    updateLastSavedTime();
                    markDataChanged();
                    
                    // Close modal
                    const importModal = bootstrap.Modal.getInstance(document.getElementById('importDataModal'));
                    importModal.hide();
                    
                } catch (error) {
                    console.error('Error processing Excel file:', error);
                    showNotification('Error processing Excel file: ' + error.message, 'danger');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Process Excel data with enhanced validation
        function processExcelData(jsonData) {
            const processedData = [];
            let validCount = 0;
            let errorCount = 0;
            
            jsonData.forEach((row, index) => {
                try {
                    // Map Excel columns to our data structure (case-insensitive)
                    const data = {
                        id: Date.now() + index, // Generate unique ID
                        date: parseExcelDate(row.Date || row.date),
                        branch: validateBranch(row.Branch || row.branch),
                        channel: validateChannel(row.Channel || row.channel),
                        transactions: parseInt(row.Transactions || row.transactions) || 0,
                        sales: parseFloat(row.Sales || row.sales) || 0,
                        averagePerOrder: row['Average per Order'] || row.averagePerOrder ? 
                            parseFloat(row['Average per Order'] || row.averagePerOrder) : 0,
                        offerType: validateOfferType(row['Offer Type'] || row.offerType),
                        offerStatus: validateOfferStatus(row['Offer Status'] || row.offerStatus),
                        notes: row.Notes || row.notes || '',
                        day: getDayOfWeek(row.Date || row.date)
                    };
                    
                    // Calculate average if not provided
                    if (data.averagePerOrder === 0 && data.transactions > 0) {
                        data.averagePerOrder = data.sales / data.transactions;
                    }
                    
                    // Enhanced validation
                    if (!validateSalesDataRecord(data)) {
                        throw new Error('Invalid sales data record');
                    }
                    
                    processedData.push(data);
                    validCount++;
                } catch (error) {
                    console.error(`Error processing row ${index + 1}:`, error.message);
                    errorCount++;
                }
            });
            
            if (errorCount > 0) {
                showNotification(`Processed ${validCount} records, skipped ${errorCount} invalid records`, 'warning');
            }
            
            return processedData;
        }

        // Enhanced sales data validation
        function validateSalesDataRecord(record) {
            // Required fields
            if (!record.date || !record.branch || !record.channel || 
                !record.transactions || !record.sales || 
                !record.offerType || !record.offerStatus) {
                return false;
            }
            
            // Data types
            if (typeof record.transactions !== 'number' || record.transactions < 0 ||
                typeof record.sales !== 'number' || record.sales < 0 ||
                (record.averagePerOrder !== undefined && (typeof record.averagePerOrder !== 'number' || record.averagePerOrder < 0))) {
                return false;
            }
            
            // Consistency checks
            if (record.transactions === 0 && record.sales !== 0) {
                return false;
            }
            
            if (record.sales === 0 && record.transactions !== 0) {
                return false;
            }
            
            if (record.transactions > 0 && record.averagePerOrder > 0 && 
                Math.abs(record.sales / record.transactions - record.averagePerOrder) > 0.01) {
                return false;
            }
            
            return true;
        }

        // Parse Excel date with enhanced error handling
        function parseExcelDate(dateValue) {
            if (!dateValue) return '';
            
            try {
                // If it's a number (Excel date format)
                if (typeof dateValue === 'number') {
                    const date = new Date((dateValue - (25567 + 1)) * 86400 * 1000);
                    return date.toISOString().split('T')[0];
                }
                
                // If it's a string, try to parse it
                if (typeof dateValue === 'string') {
                    // Try YYYY-MM-DD format
                    if (/^\d{4}-\d{2}-\d{2}$/.test(dateValue)) {
                        return dateValue;
                    }
                    
                    // Try other formats and convert
                    const date = new Date(dateValue);
                    if (!isNaN(date.getTime())) {
                        return date.toISOString().split('T')[0];
                    }
                }
            } catch (error) {
                console.error('Error parsing date:', error);
            }
            
            return '';
        }

        // Validate branch with enhanced validation
        function validateBranch(branch) {
            if (!branch) return '';
            
            // Check if branch matches any of our known branches
            const normalizedBranch = branch.trim();
            for (const knownBranch of CONFIG.BRANCHES) {
                if (normalizedBranch.toLowerCase() === knownBranch.toLowerCase()) {
                    return knownBranch;
                }
            }
            
            // If no match, return the original branch name
            return normalizedBranch;
        }

        // Validate channel with enhanced validation
        function validateChannel(channel) {
            if (!channel) return '';
            
            const normalizedChannel = channel.trim().toLowerCase();
            for (const validChannel of CONFIG.CHANNELS) {
                if (normalizedChannel === validChannel.toLowerCase()) {
                    return validChannel;
                }
            }
            
            return '';
        }

        // Validate offer type with enhanced validation
        function validateOfferType(offerType) {
            if (!offerType) return '';
            
            const normalizedType = offerType.trim();
            for (const validType of CONFIG.OFFER_TYPES) {
                if (normalizedType.toLowerCase() === validType.toLowerCase()) {
                    return validType;
                }
            }
            
            return '';
        }

        // Validate offer status with enhanced validation
        function validateOfferStatus(offerStatus) {
            if (!offerStatus) return '';
            
            const normalizedStatus = offerStatus.trim().toLowerCase();
            if (normalizedStatus === 'active' || normalizedStatus === 'no offer') {
                return normalizedStatus.charAt(0).toUpperCase() + normalizedStatus.slice(1);
            }
            
            return '';
        }

        // Show import modal
        function showImportModal() {
            const importModal = new bootstrap.Modal(document.getElementById('importDataModal'));
            importModal.show();
        }

        // Handle import type change
        document.getElementById('importType').addEventListener('change', function() {
            const importType = this.value;
            document.getElementById('jsonImportSection').style.display = importType === 'json' ? 'block' : 'none';
            document.getElementById('excelImportSection').style.display = importType === 'excel' ? 'block' : 'none';
        });

        // Handle confirm import
        document.getElementById('confirmImportBtn').addEventListener('click', function() {
            const importType = document.getElementById('importType').value;
            
            if (importType === 'json') {
                importData();
            } else if (importType === 'excel') {
                importExcelData();
            }
        });

        // Download Excel template
        function downloadExcelTemplate() {
            try {
                // Create sample data for template
                const templateData = [
                    {
                        'Date': '2025-10-01',
                        'Branch': 'Crispy Chicken-Hamdan St',
                        'Channel': 'Delivery',
                        'Transactions': 50,
                        'Sales': 2000,
                        'Average per Order': 40,
                        'Offer Type': 'Normal Day',
                        'Offer Status': 'No Offer',
                        'Notes': 'Sample data'
                    },
                    {
                        'Date': '2025-10-02',
                        'Branch': 'Crispy Chicken Khaldia',
                        'Channel': 'Delivery',
                        'Transactions': 30,
                        'Sales': 1500,
                        'Average per Order': 50,
                        'Offer Type': 'Chicken Day',
                        'Offer Status': 'Active',
                        'Notes': 'Sample data'
                    }
                ];
                
                // Create workbook
                const worksheet = XLSX.utils.json_to_sheet(templateData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Sales Data');
                
                // Generate and download file
                XLSX.writeFile(workbook, 'crispy_chicken_template.xlsx');
                
                showNotification('Excel template downloaded successfully', 'success');
            } catch (error) {
                console.error('Error downloading template:', error);
                showNotification('Error downloading template: ' + error.message, 'danger');
            }
        }

        // Initialize Excel drag and drop
        function initExcelDragAndDrop() {
            const fileDropArea = document.getElementById('fileDropArea');
            const excelFileInput = document.getElementById('excelFileInput');
            const browseLink = document.getElementById('browseLink');
            
            // Browse link click
            browseLink.addEventListener('click', function(e) {
                e.preventDefault();
                excelFileInput.click();
            });
            
            // File input change
            excelFileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    excelFile = this.files[0];
                    fileDropArea.innerHTML = `
                        <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                        <p class="mb-0">${excelFile.name}</p>
                        <p class="text-muted small">Click to change file</p>
                    `;
                }
            });
            
            // Drag and drop events
            fileDropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                fileDropArea.classList.add('drag-over');
            });
            
            fileDropArea.addEventListener('dragleave', function() {
                fileDropArea.classList.remove('drag-over');
            });
            
            fileDropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                fileDropArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || 
                        file.name.endsWith('.xlsx') || 
                        file.name.endsWith('.xls')) {
                        excelFile = file;
                        fileDropArea.innerHTML = `
                            <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                            <p class="mb-0">${file.name}</p>
                            <p class="text-muted small">Click to change file</p>
                        `;
                    } else {
                        showNotification('Please upload a valid Excel file (.xlsx or .xls)', 'danger');
                    }
                }
            });
            
            // Click to change file
            fileDropArea.addEventListener('click', function() {
                excelFileInput.click();
            });
            
            // Process Excel file from drag and drop
            document.getElementById('importExcelBtn').addEventListener('click', function() {
                if (!excelFile) {
                    showNotification('Please select an Excel file first', 'warning');
                    return;
                }
                
                if (excelFile.size > CONFIG.MAX_DATA_SIZE) {
                    showNotification('File size exceeds maximum limit', 'danger');
                    return;
                }
                
                showLoading();
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        // Process Excel data
                        const processedData = processExcelData(jsonData);
                        
                        if (processedData.length === 0) {
                            showNotification('No valid data found in Excel file', 'warning');
                            hideLoading();
                            return;
                        }
                        
                        // Merge with existing data
                        salesData = [...salesData, ...processedData];
                        updateDataTable();
                        updateDataStats();
                        updateLastSavedTime();
                        markDataChanged();
                        
                        showNotification(`Successfully imported ${processedData.length} records`, 'success');
                        
                        // Reset file input and UI
                        excelFile = null;
                        document.getElementById('excelFileInput').value = '';
                        document.getElementById('fileDropArea').innerHTML = `
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="mb-0">Drag and drop your Excel file here or <a href="#" id="browseLink">browse files</a></p>
                        `;
                        
                        // Reinitialize drag and drop
                        initExcelDragAndDrop();
                        
                    } catch (error) {
                        console.error('Error processing Excel file:', error);
                        showNotification('Error processing Excel file: ' + error.message, 'danger');
                    } finally {
                        hideLoading();
                    }
                };
                
                reader.readAsArrayBuffer(excelFile);
            });
        }

        // Clear all data with confirmation
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                if (confirm('Please confirm again to proceed with clearing all data.')) {
                    salesData = [];
                    offers = [];
                    feedbackData = [];
                    updateDataTable();
                    updateFeedbackTable();
                    updateDataStats();
                    markDataChanged();
                    showNotification('All data cleared', 'warning');
                }
            }
        }

        // Reset to sample data with confirmation
        function resetToSample() {
            if (confirm('Are you sure you want to reset all data to sample data? Current data will be lost.')) {
                if (confirm('Please confirm again to proceed with reset to sample data.')) {
                    // Reset to initial sample data
                    salesData = [
                        { id: 1, date: '2025-10-01', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 73, sales: 3216, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 2, date: '2025-10-01', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 38, sales: 1859.8, averagePerOrder: 49, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 3, date: '2025-10-01', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 39, sales: 1965, averagePerOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 4, date: '2025-10-01', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 42, sales: 2024, averagePerOrder: 48, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 5, date: '2025-10-01', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 24, sales: 1376, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 6, date: '2025-10-01', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 387, averagePerOrder: 35, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 7, date: '2025-10-01', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 5, sales: 204, averagePerOrder: 41, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 8, date: '2025-10-02', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 62, sales: 3238, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 9, date: '2025-10-02', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 28, sales: 1492, averagePerOrder: 53, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 10, date: '2025-10-02', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 44, sales: 2057, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 11, date: '2025-10-02', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 40, sales: 1945, averagePerOrder: 49, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 12, date: '2025-10-02', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 30, sales: 1644, averagePerOrder: 55, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 13, date: '2025-10-02', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 10, sales: 527, averagePerOrder: 53, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 14, date: '2025-10-02', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 15, sales: 761, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 15, date: '2025-10-03', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 72, sales: 4287, averagePerOrder: 60, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 16, date: '2025-10-03', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 46, sales: 2930, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 17, date: '2025-10-03', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 40, sales: 1828, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 18, date: '2025-10-03', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 32, sales: 1617, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 19, date: '2025-10-03', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 29, sales: 1127, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 20, date: '2025-10-03', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 427, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 21, date: '2025-10-03', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 10, sales: 475, averagePerOrder: 48, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 22, date: '2025-10-04', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 84, sales: 4833, averagePerOrder: 58, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 23, date: '2025-10-04', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 43, sales: 2400, averagePerOrder: 56, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 24, date: '2025-10-04', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 31, sales: 1447, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 25, date: '2025-10-04', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 36, sales: 2299, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 26, date: '2025-10-04', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 20, sales: 936, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 27, date: '2025-10-04', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 11, sales: 566, averagePerOrder: 51, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 28, date: '2025-10-04', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 15, sales: 554, averagePerOrder: 37, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 29, date: '2025-10-05', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 76, sales: 2921, averagePerOrder: 38, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 30, date: '2025-10-05', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 43, sales: 1982, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 31, date: '2025-10-05', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 29, sales: 1344, averagePerOrder: 46, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 32, date: '2025-10-05', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 20, sales: 1126, averagePerOrder: 56, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 33, date: '2025-10-05', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 25, sales: 1089.9, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 34, date: '2025-10-05', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 13, sales: 462, averagePerOrder: 36, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 35, date: '2025-10-05', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 8, sales: 241, averagePerOrder: 30, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 36, date: '2025-10-06', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 101, sales: 4363, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 37, date: '2025-10-06', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 54, sales: 2113, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 38, date: '2025-10-06', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 61, sales: 2714.8, averagePerOrder: 45, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 39, date: '2025-10-06', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 47, sales: 2124, averagePerOrder: 45, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 40, date: '2025-10-06', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 57, sales: 4201, averagePerOrder: 74, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 41, date: '2025-10-06', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 20, sales: 848, averagePerOrder: 42, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 42, date: '2025-10-06', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 18, sales: 708, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 43, date: '2025-10-07', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 119, sales: 5056, averagePerOrder: 42, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 44, date: '2025-10-07', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 50, sales: 2175, averagePerOrder: 44, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 45, date: '2025-10-07', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 80, sales: 3475, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 46, date: '2025-10-07', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 46, sales: 1957, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 47, date: '2025-10-07', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 44, sales: 2590, averagePerOrder: 59, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 48, date: '2025-10-07', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 18, sales: 705, averagePerOrder: 39, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 49, date: '2025-10-07', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 19, sales: 823, averagePerOrder: 43, offerType: 'Ultimate', offerStatus: 'Active', notes: '' },
                        { id: 50, date: '2025-10-08', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 58, sales: 2568.9, averagePerOrder: 44, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 51, date: '2025-10-08', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 24, sales: 1037, averagePerOrder: 43, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 52, date: '2025-10-08', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 30, sales: 1574, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 53, date: '2025-10-08', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 30, sales: 1404, averagePerOrder: 47, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 54, date: '2025-10-08', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 29, sales: 1891, averagePerOrder: 65, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 55, date: '2025-10-08', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 5, sales: 148, averagePerOrder: 30, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 56, date: '2025-10-08', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 8, sales: 476, averagePerOrder: 60, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 57, date: '2025-10-09', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 53, sales: 2738, averagePerOrder: 52, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 58, date: '2025-10-09', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 31, sales: 2112, averagePerOrder: 68, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 59, date: '2025-10-09', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 35, sales: 1487, averagePerOrder: 42, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 60, date: '2025-10-09', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 35, sales: 1978, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 61, date: '2025-10-09', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 17, sales: 733, averagePerOrder: 43, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 62, date: '2025-10-09', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 5, sales: 184, averagePerOrder: 37, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 63, date: '2025-10-09', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 13, sales: 408, averagePerOrder: 31, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 64, date: '2025-10-10', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 65, sales: 2900, averagePerOrder: 45, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 65, date: '2025-10-10', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 46, sales: 2943, averagePerOrder: 64, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 66, date: '2025-10-10', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 45, sales: 2411, averagePerOrder: 54, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 67, date: '2025-10-10', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 39, sales: 2261, averagePerOrder: 58, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 68, date: '2025-10-10', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 25, sales: 1523, averagePerOrder: 61, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 69, date: '2025-10-10', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 12, sales: 976, averagePerOrder: 81, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 70, date: '2025-10-10', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 10, sales: 573, averagePerOrder: 57, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 71, date: '2025-10-11', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 78, sales: 4313, averagePerOrder: 55, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 72, date: '2025-10-11', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 48, sales: 3452, averagePerOrder: 72, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 73, date: '2025-10-11', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 34, sales: 1711, averagePerOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 74, date: '2025-10-11', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 28, sales: 1654, averagePerOrder: 59, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 75, date: '2025-10-11', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 20, sales: 778, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 76, date: '2025-10-11', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 10, sales: 391, averagePerOrder: 39, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 77, date: '2025-10-11', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 9, sales: 275, averagePerOrder: 31, offerType: 'Normal Day', offerStatus: 'No Offer', notes: '' },
                        { id: 78, date: '2025-10-12', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 51, sales: 2146, averagePerOrder: 42, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 79, date: '2025-10-12', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 33, sales: 1802, averagePerOrder: 55, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 80, date: '2025-10-12', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 32, sales: 1331, averagePerOrder: 42, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 81, date: '2025-10-12', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 23, sales: 1195, averagePerOrder: 52, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 82, date: '2025-10-12', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 22, sales: 1233, averagePerOrder: 56, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 83, date: '2025-10-12', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 4, sales: 153, averagePerOrder: 38, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 84, date: '2025-10-12', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 6, sales: 232, averagePerOrder: 39, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 85, date: '2025-10-13', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 113, sales: 4089, averagePerOrder: 36, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 86, date: '2025-10-13', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 57, sales: 2344, averagePerOrder: 41, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 87, date: '2025-10-13', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 77, sales: 3422, averagePerOrder: 44, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 88, date: '2025-10-13', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 42, sales: 1803, averagePerOrder: 43, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 89, date: '2025-10-13', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 46, sales: 2574, averagePerOrder: 56, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 90, date: '2025-10-13', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 18, sales: 657, averagePerOrder: 37, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 91, date: '2025-10-13', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 17, sales: 741, averagePerOrder: 44, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 92, date: '2025-10-14', branch: 'Crispy Chicken-Hamdan St', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 93, date: '2025-10-14', branch: 'Crispy Chicken Khaldia', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 94, date: '2025-10-14', branch: 'Crispy Chicken Shabiya 11', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 95, date: '2025-10-14', branch: 'Crispy Chicken Muroor', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 96, date: '2025-10-14', branch: 'Crispy Chicken Al Barsha', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 97, date: '2025-10-14', branch: 'Crispy Chicken Al Satwa', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' },
                        { id: 98, date: '2025-10-14', branch: 'Crispy Chicken Al Rgga', channel: 'Delivery', transactions: 0, sales: 0, averagePerOrder: 0, offerType: 'Chicken Day', offerStatus: 'Active', notes: '' }
                    ];
                    
                    // Add id and day to reset sample data
                    salesData = salesData.map((item, index) => ({
                        id: index + 1,
                        day: getDayOfWeek(item.date),
                        ...item
                    }));
                    
                    offers = [
                        { id: 1, name: 'Weekend Special', type: 'Normal Day', discount: 15, startDate: '2025-10-01', endDate: '2025-10-31', status: 'Active' },
                        { id: 2, name: 'Chicken Fiesta', type: 'Chicken Day', discount: 25, startDate: '2025-10-01', endDate: '2025-10-15', status: 'Active' },
                        { id: 3, name: 'Ultimate Combo', type: 'Ultimate', discount: 30, startDate: '2025-10-01', endDate: '2025-10-31', status: 'Active' }
                    ];
                    
                    feedbackData = [
                        { id: 1, date: '2025-10-01', branch: 'Crispy Chicken-Hamdan St', rating: 5, comment: 'Great service! The chicken was fresh and delicious.', category: 'Service', status: 'Resolved', response: 'Thank you for your feedback! We\'re glad you enjoyed our service.' },
                        { id: 2, date: '2025-10-02', branch: 'Crispy Chicken Khaldia', rating: 4, comment: 'Food was delicious but delivery took longer than expected.', category: 'Food', status: 'In Progress', response: '' },
                        { id: 3, date: '2025-10-03', branch: 'Crispy Chicken Shabiya 11', rating: 3, comment: 'The restaurant was clean but the staff seemed overwhelmed.', category: 'Service', status: 'New', response: '' },
                        { id: 4, date: '2025-10-04', branch: 'Crispy Chicken Muroor', rating: 5, comment: 'Excellent experience! Will definitely come back.', category: 'Cleanliness', status: 'Resolved', response: 'Thank you for your 5-star rating!' },
                        { id: 5, date: '2025-10-05', branch: 'Crispy Chicken Al Barsha', rating: 2, comment: 'The chicken was too dry and not seasoned well.', category: 'Food', status: 'In Progress', response: 'We apologize for the experience. Our team will review this immediately.' },
                        { id: 6, date: '2025-10-06', branch: 'Crispy Chicken-Hamdan St', rating: 4, comment: 'Good value for money during the Ultimate offer.', category: 'Food', status: 'Resolved', response: 'Glad you enjoyed our Ultimate offer!' },
                        { id: 7, date: '2025-10-07', branch: 'Crispy Chicken Khaldia', rating: 5, comment: 'Best chicken in town! The Ultimate combo is amazing.', category: 'Food', status: 'Resolved', response: 'Thank you for your amazing feedback!' },
                        { id: 8, date: '2025-10-08', branch: 'Crispy Chicken Shabiya 11', rating: 3, comment: 'Average experience. Nothing special but not bad either.', category: 'Other', status: 'Resolved', response: 'We appreciate your feedback and will continue to improve.' }
                    ];
                    
                    updateDataTable();
                    updateFeedbackTable();
                    updateDataStats();
                    markDataChanged();
                    showNotification('Data reset to sample', 'info');
                }
            }
        }

        // Update data statistics
        function updateDataStats() {
            document.getElementById('salesRecordsCount').textContent = salesData.length;
            document.getElementById('offersCount').textContent = offers.length;
            document.getElementById('feedbackCount').textContent = feedbackData.length;
            
            // Calculate total data size
            const totalData = {
                salesData: salesData,
                offers: offers,
                feedbackData: feedbackData
            };
            const dataSize = JSON.stringify(totalData).length;
            const dataSizeKB = (dataSize / 1024).toFixed(2);
            document.getElementById('totalDataSize').textContent = dataSizeKB + ' KB';
        }

        // Update last saved time
        function updateLastSavedTime() {
            const savedData = localStorage.getItem('crispyChickenData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.timestamp) {
                        const date = new Date(data.timestamp);
                        const formattedDate = date.toLocaleString();
                        document.getElementById('lastSavedTime').textContent = formattedDate;
                    }
                } catch (error) {
                    document.getElementById('lastSavedTime').textContent = 'Invalid timestamp';
                }
            } else {
                document.getElementById('lastSavedTime').textContent = 'Never';
            }
        }

        // Update dashboard with filtered data
        function updateDashboard() {
            showLoading();
            
            // Get filter values
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const branchFilter = document.getElementById('branchFilter').value;
            const offerFilter = document.getElementById('offerFilter').value;
            
            // Validate date range
            if (new Date(startDate) > new Date(endDate)) {
                showNotification('Start date must be before end date', 'warning');
                hideLoading();
                return;
            }
            
            // Filter data
            let filteredData = salesData.filter(item => {
                const itemDate = new Date(item.date);
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                const dateMatch = itemDate >= start && itemDate <= end;
                const branchMatch = branchFilter === 'all' || item.branch === branchFilter;
                const offerMatch = offerFilter === 'all' || item.offerType === offerFilter;
                
                return dateMatch && branchMatch && offerMatch;
            });
            
            // Update key metrics
            updateKeyMetrics(filteredData);
            
            // Update charts
            updateSalesTrendChart(filteredData);
            updateBranchSalesChart(filteredData);
            updateBranchPerformanceRadarChart(filteredData);
            updateBranchPerformanceRankingChart(filteredData);
            updateDailyTrendsChart(filteredData);
            updateWeeklyTrendsChart(filteredData);
            updateMovingAverageChart(filteredData);
            updateDailySalesTable(filteredData);
            updateInsights(filteredData);
            updateOffersTable();
            updateFeedbackAnalysis();
            
            hideLoading();
        }

        // Update key metrics
        function updateKeyMetrics(data) {
            const totalSales = data.reduce((sum, item) => sum + item.sales, 0);
            const totalTransactions = data.reduce((sum, item) => sum + item.transactions, 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            const targetAchievement = (totalSales / CONFIG.TARGET_SALES * 100).toFixed(1);
            
            document.getElementById('totalSales').textContent = formatCurrency(totalSales);
            document.getElementById('totalTransactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('avgTransaction').textContent = formatCurrency(avgTransaction);
            document.getElementById('targetAchievement').textContent = `${targetAchievement}%`;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-AE', {
                style: 'currency',
                currency: 'AED',
                minimumFractionDigits: 2
            }).format(amount);
        }

        // Get day of week
        function getDayOfWeek(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { weekday: 'long' });
        }

        // Update sales trend chart
        function updateSalesTrendChart(data) {
            // Group data by date
            const groupedData = {};
            data.forEach(item => {
                if (!groupedData[item.date]) {
                    groupedData[item.date] = 0;
                }
                groupedData[item.date] += item.sales;
            });
            
            // Sort dates
            const sortedDates = Object.keys(groupedData).sort();
            const salesValues = sortedDates.map(date => groupedData[date]);
            
            // Update chart
            if (chartInstances.salesTrend) {
                chartInstances.salesTrend.data.labels = sortedDates;
                chartInstances.salesTrend.data.datasets[0].data = salesValues;
                chartInstances.salesTrend.update();
            }
        }

        // Update branch sales chart
        function updateBranchSalesChart(data) {
            // Group data by branch
            const branchSales = {};
            data.forEach(item => {
                if (!branchSales[item.branch]) {
                    branchSales[item.branch] = 0;
                }
                branchSales[item.branch] += item.sales;
            });
            
            // Update chart
            if (chartInstances.branchSales) {
                chartInstances.branchSales.data.labels = Object.keys(branchSales);
                chartInstances.branchSales.data.datasets[0].data = Object.values(branchSales);
                chartInstances.branchSales.update();
            }
        }

        // Update branch performance radar chart
        function updateBranchPerformanceRadarChart(data) {
            // Group data by branch
            const branchPerformance = {};
            data.forEach(item => {
                if (!branchPerformance[item.branch]) {
                    branchPerformance[item.branch] = {
                        sales: 0,
                        transactions: 0,
                        avgOrder: 0
                    };
                }
                branchPerformance[item.branch].sales += item.sales;
                branchPerformance[item.branch].transactions += item.transactions;
            });
            
            // Calculate metrics
            const branches = Object.keys(branchPerformance);
            const salesData = branches.map(branch => branchPerformance[branch].sales);
            const transactionsData = branches.map(branch => branchPerformance[branch].transactions);
            const avgOrderData = branches.map(branch => {
                const perf = branchPerformance[branch];
                return perf.transactions > 0 ? perf.sales / perf.transactions : 0;
            });
            
            // Update chart
            if (chartInstances.branchPerformanceRadar) {
                chartInstances.branchPerformanceRadar.data.labels = branches;
                chartInstances.branchPerformanceRadar.data.datasets[0].data = salesData;
                chartInstances.branchPerformanceRadar.data.datasets[1].data = transactionsData;
                chartInstances.branchPerformanceRadar.data.datasets[2].data = avgOrderData;
                chartInstances.branchPerformanceRadar.update();
            }
        }

        // Update branch performance ranking chart
        function updateBranchPerformanceRankingChart(data) {
            // Group data by branch
            const branchPerformance = {};
            data.forEach(item => {
                if (!branchPerformance[item.branch]) {
                    branchPerformance[item.branch] = {
                        sales: 0,
                        transactions: 0,
                        avgOrder: 0
                    };
                }
                branchPerformance[item.branch].sales += item.sales;
                branchPerformance[item.branch].transactions += item.transactions;
            });
            
            // Calculate rankings
            const branches = Object.keys(branchPerformance);
            const rankings = branches.map(branch => {
                const perf = branchPerformance[branch];
                const score = (perf.sales / 1000) + (perf.transactions / 10) + (perf.avgOrder / 10);
                return { branch, score };
            }).sort((a, b) => b.score - a.score);
            
            // Update chart
            if (chartInstances.branchPerformanceRanking) {
                chartInstances.branchPerformanceRanking.data.labels = rankings.map(r => r.branch);
                chartInstances.branchPerformanceRanking.data.datasets[0].data = rankings.map(r => r.score);
                chartInstances.branchPerformanceRanking.update();
            }
        }

        // Update daily trends chart
        function updateDailyTrendsChart(data) {
            // Group data by day of week
            const dayOfWeekData = {};
            CONFIG.DAYS_OF_WEEK.forEach(day => {
                dayOfWeekData[day] = { sales: 0, transactions: 0 };
            });
            
            data.forEach(item => {
                const day = item.day;
                if (dayOfWeekData[day]) {
                    dayOfWeekData[day].sales += item.sales;
                    dayOfWeekData[day].transactions += item.transactions;
                }
            });
            
            // Update chart
            if (chartInstances.dailyTrends) {
                chartInstances.dailyTrends.data.labels = CONFIG.DAYS_OF_WEEK;
                chartInstances.dailyTrends.data.datasets[0].data = CONFIG.DAYS_OF_WEEK.map(day => dayOfWeekData[day].sales);
                chartInstances.dailyTrends.data.datasets[1].data = CONFIG.DAYS_OF_WEEK.map(day => dayOfWeekData[day].transactions);
                chartInstances.dailyTrends.update();
            }
        }

        // Update weekly trends chart
        function updateWeeklyTrendsChart(data) {
            // Group data by week
            const weekData = {};
            data.forEach(item => {
                const week = getWeekNumber(item.date);
                if (!weekData[week]) {
                    weekData[week] = { sales: 0, transactions: 0 };
                }
                weekData[week].sales += item.sales;
                weekData[week].transactions += item.transactions;
            });
            
            // Update chart
            if (chartInstances.weeklyTrends) {
                const weeks = Object.keys(weekData).sort();
                chartInstances.weeklyTrends.data.labels = weeks;
                chartInstances.weeklyTrends.data.datasets[0].data = weeks.map(week => weekData[week].sales);
                chartInstances.weeklyTrends.data.datasets[1].data = weeks.map(week => weekData[week].transactions);
                chartInstances.weeklyTrends.update();
            }
        }

        // Get week number
        function getWeekNumber(dateString) {
            const date = new Date(dateString);
            const start = new Date(date.getFullYear(), 0, 1);
            const diff = date - start;
            const oneWeek = 7 * 24 * 60 * 60 * 1000;
            return Math.ceil(diff / oneWeek);
        }

        // Update moving average chart
        function updateMovingAverageChart(data) {
            // Calculate moving averages
            const windowSize = 7;
            const movingAverages = [];
            const dates = data.map(item => item.date).sort();
            
            for (let i = 0; i < dates.length; i++) {
                if (i < windowSize - 1) {
                    movingAverages.push(null);
                } else {
                    const window = dates.slice(i - windowSize + 1, i + 1);
                    const windowSales = window.reduce((sum, date) => {
                        const dayData = data.filter(item => item.date === date);
                        return sum + dayData.reduce((daySum, item) => daySum + item.sales, 0);
                    }, 0);
                    movingAverages.push(windowSales / windowSize);
                }
            }
            
            // Update chart
            if (chartInstances.movingAverage) {
                chartInstances.movingAverage.data.labels = dates;
                chartInstances.movingAverage.data.datasets[0].data = movingAverages;
                chartInstances.movingAverage.update();
            }
        }

        // Update daily sales table
        function updateDailySalesTable(data) {
            const tbody = document.getElementById('dailySalesTable');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.branch}</td>
                    <td>${item.channel}</td>
                    <td>${item.transactions}</td>
                    <td>${formatCurrency(item.sales)}</td>
                    <td>${formatCurrency(item.averagePerOrder)}</td>
                    <td>
                        <span class="offer-badge offer-${item.offerType.toLowerCase().replace(' ', '-')}">
                            ${item.offerType}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${item.offerStatus}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update insights
        function updateInsights(data) {
            // Anomaly detection
            const anomalies = detectAnomalies(data);
            const anomalyText = anomalies.length > 0 
                ? `Detected ${anomalies.length} anomalies: ${anomalies.join(', ')}`
                : 'No anomalies detected';
            document.getElementById('anomalyText').textContent = anomalyText;
            
            // Predictive analytics
            const prediction = predictSales(data);
            document.getElementById('predictionText').textContent = prediction;
            
            // Key findings
            const findings = generateKeyFindings(data);
            const findingsList = document.getElementById('keyFindingsList');
            findingsList.innerHTML = findings.map(finding => `<li>${finding}</li>`).join('');
        }

        // Detect anomalies
        function detectAnomalies(data) {
            const anomalies = [];
            const avgSales = data.reduce((sum, item) => sum + item.sales, 0) / data.length;
            const stdDev = Math.sqrt(data.reduce((sum, item) => sum + Math.pow(item.sales - avgSales, 2), 0) / data.length);
            
            data.forEach(item => {
                if (Math.abs(item.sales - avgSales) > 2 * stdDev) {
                    anomalies.push(`${item.date} (${item.branch})`);
                }
            });
            
            return anomalies;
        }

        // Predict sales
        function predictSales(data) {
            const trend = calculateTrend(data);
            return `Expected sales trend: ${trend > 0 ? 'increasing' : 'decreasing'} by ${Math.abs(trend).toFixed(1)}%`;
        }

        // Calculate trend
        function calculateTrend(data) {
            const firstHalf = data.slice(0, Math.floor(data.length / 2));
            const secondHalf = data.slice(Math.floor(data.length / 2));
            
            const firstHalfAvg = firstHalf.reduce((sum, item) => sum + item.sales, 0) / firstHalf.length;
            const secondHalfAvg = secondHalf.reduce((sum, item) => sum + item.sales, 0) / secondHalf.length;
            
            return ((secondHalfAvg - firstHalfAvg) / firstHalfAvg) * 100;
        }

        // Generate key findings
        function generateKeyFindings(data) {
            const findings = [];
            
            // Best performing branch
            const branchSales = {};
            data.forEach(item => {
                if (!branchSales[item.branch]) {
                    branchSales[item.branch] = 0;
                }
                branchSales[item.branch] += item.sales;
            });
            
            const bestBranch = Object.keys(branchSales).reduce((a, b) => 
                branchSales[a] > branchSales[b] ? a : b
            );
            findings.push(`${bestBranch} has the highest sales`);
            
            // Best performing offer
            const offerSales = {};
            data.forEach(item => {
                if (!offerSales[item.offerType]) {
                    offerSales[item.offerType] = 0;
                }
                offerSales[item.offerType] += item.sales;
            });
            
            const bestOffer = Object.keys(offerSales).reduce((a, b) => 
                offerSales[a] > offerSales[b] ? a : b
            );
            findings.push(`${bestOffer} offers generate the most sales`);
            
            // Peak days
            const daySales = {};
            CONFIG.DAYS_OF_WEEK.forEach(day => {
                daySales[day] = 0;
            });
            
            data.forEach(item => {
                daySales[item.day] += item.sales;
            });
            
            const peakDay = Object.keys(daySales).reduce((a, b) => 
                daySales[a] > daySales[b] ? a : b
            );
            findings.push(`${peakDay} is the peak sales day`);
            
            return findings;
        }

        // Update offers table
        function updateOffersTable() {
            const tbody = document.getElementById('offersTable');
            tbody.innerHTML = '';
            
            offers.forEach(offer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${offer.name}</td>
                    <td>${offer.type}</td>
                    <td>${offer.discount}%</td>
                    <td>${offer.startDate}</td>
                    <td>${offer.endDate}</td>
                    <td>
                        <span class="badge ${offer.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${offer.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editOffer(${offer.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteOffer(${offer.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Edit offer
        function editOffer(id) {
            const offer = offers.find(o => o.id === id);
            if (offer) {
                currentEditingOffer = offer;
                document.getElementById('offerName').value = offer.name;
                document.getElementById('offerType').value = offer.type;
                document.getElementById('offerDiscount').value = offer.discount;
                document.getElementById('offerStartDate').value = offer.startDate;
                document.getElementById('offerEndDate').value = offer.endDate;
                
                const modal = new bootstrap.Modal(document.getElementById('addOfferModal'));
                modal.show();
            }
        }

        // Delete offer
        function deleteOffer(id) {
            if (confirm('Are you sure you want to delete this offer?')) {
                offers = offers.filter(o => o.id !== id);
                updateOffersTable();
                showNotification('Offer deleted', 'success');
            }
        }

        // Save offer
        function saveOffer() {
            const offerData = {
                name: document.getElementById('offerName').value,
                type: document.getElementById('offerType').value,
                discount: parseInt(document.getElementById('offerDiscount').value),
                startDate: document.getElementById('offerStartDate').value,
                endDate: document.getElementById('offerEndDate').value
            };
            
            if (currentEditingOffer) {
                // Update existing offer
                Object.assign(currentEditingOffer, offerData);
                showNotification('Offer updated', 'success');
            } else {
                // Add new offer
                offerData.id = Date.now();
                offerData.status = 'Active';
                offers.push(offerData);
                showNotification('Offer added', 'success');
            }
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addOfferModal'));
            modal.hide();
            
            // Reset form
            document.getElementById('offerForm').reset();
            currentEditingOffer = null;
            
            updateOffersTable();
        }

        // Reset offer modal
        function resetOfferModal() {
            document.getElementById('offerForm').reset();
            currentEditingOffer = null;
        }

        // Update feedback analysis
        function updateFeedbackAnalysis() {
            // Calculate feedback metrics
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                : 0;
            
            const positiveFeedback = totalFeedback > 0
                ? (feedbackData.filter(item => item.rating >= 4).length / totalFeedback * 100).toFixed(1)
                : 0;
            
            document.getElementById('totalFeedback').textContent = totalFeedback;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('positiveFeedback').textContent = positiveFeedback + '%';
            
            // Update feedback category chart
            updateFeedbackCategoryChart();
            
            // Update rating distribution chart
            updateRatingDistributionChart();
            
            // Update recent feedback list
            updateRecentFeedbackList();
        }

        // Update feedback category chart
        function updateFeedbackCategoryChart() {
            // Group feedback by category
            const categoryCounts = {};
            CONFIG.FEEDBACK_CATEGORIES.forEach(category => {
                categoryCounts[category] = 0;
            });
            
            feedbackData.forEach(item => {
                if (categoryCounts[item.category] !== undefined) {
                    categoryCounts[item.category]++;
                }
            });
            
            // Update chart
            if (chartInstances.feedbackCategory) {
                chartInstances.feedbackCategory.data.labels = Object.keys(categoryCounts);
                chartInstances.feedbackCategory.data.datasets[0].data = Object.values(categoryCounts);
                chartInstances.feedbackCategory.update();
            }
        }

        // Update rating distribution chart
        function updateRatingDistributionChart() {
            // Count ratings
            const ratingCounts = [0, 0, 0, 0, 0];
            
            feedbackData.forEach(item => {
                if (item.rating >= 1 && item.rating <= 5) {
                    ratingCounts[item.rating - 1]++;
                }
            });
            
            // Update chart
            if (chartInstances.ratingDistribution) {
                chartInstances.ratingDistribution.data.datasets[0].data = ratingCounts;
                chartInstances.ratingDistribution.update();
            }
        }

        // Update recent feedback list
        function updateRecentFeedbackList() {
            const container = document.getElementById('recentFeedbackList');
            container.innerHTML = '';
            
            const recentFeedback = feedbackData.slice(0, 5);
            
            recentFeedback.forEach(item => {
                const card = document.createElement('div');
                card.className = 'feedback-card';
                card.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6>${item.branch}</h6>
                            <div class="rating-input">
                                ${generateStars(item.rating)}
                            </div>
                        </div>
                        <span class="feedback-category category-${item.category.toLowerCase()}">${item.category}</span>
                    </div>
                    <p class="mt-2">${item.comment}</p>
                    <div class="feedback-meta">
                        <span>${item.date}</span>
                        <span class="badge ${item.status === 'Resolved' ? 'bg-success' : item.status === 'In Progress' ? 'bg-warning' : 'bg-secondary'}">${item.status}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Generate stars for rating
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star text-warning"></i>';
                } else {
                    stars += '<i class="far fa-star text-warning"></i>';
                }
            }
            return stars;
        }

        // Update management report
        function updateManagementReport() {
            // Update report metrics
            const totalSales = salesData.reduce((sum, item) => sum + item.sales, 0);
            const totalTransactions = salesData.reduce((sum, item) => sum + item.transactions, 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            document.getElementById('reportTotalSales').textContent = formatCurrency(totalSales);
            document.getElementById('reportTotalTransactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('reportAvgTransaction').textContent = formatCurrency(avgTransaction);
            
            // Update feedback metrics
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                : 0;
            
            const positiveFeedback = totalFeedback > 0
                ? (feedbackData.filter(item => item.rating >= 4).length / totalFeedback * 100).toFixed(1)
                : 0;
            
            document.getElementById('reportTotalFeedback').textContent = totalFeedback;
            document.getElementById('reportAvgRating').textContent = avgRating;
            document.getElementById('reportPositiveFeedback').textContent = positiveFeedback + '%';
            
            // Update charts
            updateBranchPerformanceChart();
            updateDailyWeeklyPerformanceChart();
            updateMonthlyTrendChart();
            updateTargetPlanChart();
            updateFeedbackCategoryReportChart();
            updateFeedbackRatingReportChart();
        }

        // Update branch performance chart
        function updateBranchPerformanceChart() {
            // Group data by branch
            const branchSales = {};
            salesData.forEach(item => {
                if (!branchSales[item.branch]) {
                    branchSales[item.branch] = 0;
                }
                branchSales[item.branch] += item.sales;
            });
            
            // Update chart
            if (chartInstances.branchPerformance) {
                chartInstances.branchPerformance.data.labels = Object.keys(branchSales);
                chartInstances.branchPerformance.data.datasets[0].data = Object.values(branchSales);
                chartInstances.branchPerformance.update();
            }
        }

        // Update daily weekly performance chart
        function updateDailyWeeklyPerformanceChart() {
            // Group data by day of week
            const dayOfWeekData = {};
            CONFIG.DAYS_OF_WEEK.forEach(day => {
                dayOfWeekData[day] = { sales: 0, transactions: 0 };
            });
            
            salesData.forEach(item => {
                const day = item.day;
                if (dayOfWeekData[day]) {
                    dayOfWeekData[day].sales += item.sales;
                    dayOfWeekData[day].transactions += item.transactions;
                }
            });
            
            // Update chart
            if (chartInstances.dailyWeeklyPerformance) {
                chartInstances.dailyWeeklyPerformance.data.labels = CONFIG.DAYS_OF_WEEK;
                chartInstances.dailyWeeklyPerformance.data.datasets[0].data = CONFIG.DAYS_OF_WEEK.map(day => dayOfWeekData[day].sales);
                chartInstances.dailyWeeklyPerformance.data.datasets[1].data = CONFIG.DAYS_OF_WEEK.map(day => dayOfWeekData[day].transactions);
                chartInstances.dailyWeeklyPerformance.update();
            }
        }

        // Update monthly trend chart
        function updateMonthlyTrendChart() {
            // Group data by week
            const weekData = {};
            salesData.forEach(item => {
                const week = getWeekNumber(item.date);
                if (!weekData[week]) {
                    weekData[week] = 0;
                }
                weekData[week] += item.sales;
            });
            
            // Update chart
            if (chartInstances.monthlyTrend) {
                const weeks = Object.keys(weekData).sort();
                chartInstances.monthlyTrend.data.labels = weeks;
                chartInstances.monthlyTrend.data.datasets[0].data = weeks.map(week => weekData[week]);
                chartInstances.monthlyTrend.update();
            }
        }

        // Update target plan chart
        function updateTargetPlanChart() {
            // Calculate target distribution
            const branchSales = {};
            salesData.forEach(item => {
                if (!branchSales[item.branch]) {
                    branchSales[item.branch] = 0;
                }
                branchSales[item.branch] += item.sales;
            });
            
            const totalSales = Object.values(branchSales).reduce((sum, sales) => sum + sales, 0);
            const targetDistribution = {
                'Hamdan St': 35,
                'Khaldia': 25,
                'Al Barsha': 20,
                'Others': 20
            };
            
            // Update chart
            if (chartInstances.targetPlan) {
                chartInstances.targetPlan.data.labels = Object.keys(targetDistribution);
                chartInstances.targetPlan.data.datasets[0].data = Object.values(targetDistribution);
                chartInstances.targetPlan.update();
            }
        }

        // Update feedback category report chart
        function updateFeedbackCategoryReportChart() {
            // Group feedback by category
            const categoryCounts = {};
            CONFIG.FEEDBACK_CATEGORIES.forEach(category => {
                categoryCounts[category] = 0;
            });
            
            feedbackData.forEach(item => {
                if (categoryCounts[item.category] !== undefined) {
                    categoryCounts[item.category]++;
                }
            });
            
            // Update chart
            if (chartInstances.feedbackCategoryReport) {
                chartInstances.feedbackCategoryReport.data.labels = Object.keys(categoryCounts);
                chartInstances.feedbackCategoryReport.data.datasets[0].data = Object.values(categoryCounts);
                chartInstances.feedbackCategoryReport.update();
            }
        }

        // Update feedback rating report chart
        function updateFeedbackRatingReportChart() {
            // Count ratings
            const ratingCounts = [0, 0, 0, 0, 0];
            
            feedbackData.forEach(item => {
                if (item.rating >= 1 && item.rating <= 5) {
                    ratingCounts[item.rating - 1]++;
                }
            });
            
            // Update chart
            if (chartInstances.feedbackRatingReport) {
                chartInstances.feedbackRatingReport.data.datasets[0].data = ratingCounts;
                chartInstances.feedbackRatingReport.update();
            }
        }

        // Update feedback management
        function updateFeedbackManagement() {
            // Update feedback summary cards
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                : 0;
            
            const positiveFeedback = totalFeedback > 0
                ? (feedbackData.filter(item => item.rating >= 4).length / totalFeedback * 100).toFixed(1)
                : 0;
            
            const negativeFeedback = totalFeedback > 0
                ? (feedbackData.filter(item => item.rating <= 2).length / totalFeedback * 100).toFixed(1)
                : 0;
            
            document.getElementById('feedbackTotal').textContent = totalFeedback;
            document.getElementById('feedbackAvgRating').textContent = avgRating;
            document.getElementById('feedbackPositive').textContent = positiveFeedback + '%';
            document.getElementById('feedbackNegative').textContent = negativeFeedback + '%';
            
            // Update feedback overview charts
            updateFeedbackOverviewCategoryChart();
            updateFeedbackOverviewRatingChart();
            
            // Update branch performance table
            updateBranchPerformanceTable();
            
            // Update existing categories table
            updateExistingCategoriesTable();
            
            // Update category performance table
            updateCategoryPerformanceTable();
            
            // Update feedback list
            updateFeedbackList();
        }

        // Update feedback overview category chart
        function updateFeedbackOverviewCategoryChart() {
            // Group feedback by category
            const categoryCounts = {};
            CONFIG.FEEDBACK_CATEGORIES.forEach(category => {
                categoryCounts[category] = 0;
            });
            
            feedbackData.forEach(item => {
                if (categoryCounts[item.category] !== undefined) {
                    categoryCounts[item.category]++;
                }
            });
            
            // Update chart
            if (chartInstances.feedbackOverviewCategory) {
                chartInstances.feedbackOverviewCategory.data.labels = Object.keys(categoryCounts);
                chartInstances.feedbackOverviewCategory.data.datasets[0].data = Object.values(categoryCounts);
                chartInstances.feedbackOverviewCategory.update();
            }
        }

        // Update feedback overview rating chart
        function updateFeedbackOverviewRatingChart() {
            // Count ratings
            const ratingCounts = [0, 0, 0, 0, 0];
            
            feedbackData.forEach(item => {
                if (item.rating >= 1 && item.rating <= 5) {
                    ratingCounts[item.rating - 1]++;
                }
            });
            
            // Update chart
            if (chartInstances.feedbackOverviewRating) {
                chartInstances.feedbackOverviewRating.data.datasets[0].data = ratingCounts;
                chartInstances.feedbackOverviewRating.update();
            }
        }

        // Update branch performance table
        function updateBranchPerformanceTable() {
            const tbody = document.getElementById('branchPerformanceTable');
            tbody.innerHTML = '';
            
            // Group feedback by branch
            const branchFeedback = {};
            feedbackData.forEach(item => {
                if (!branchFeedback[item.branch]) {
                    branchFeedback[item.branch] = [];
                }
                branchFeedback[item.branch].push(item);
            });
            
            // Calculate metrics for each branch
            Object.keys(branchFeedback).forEach(branch => {
                const feedback = branchFeedback[branch];
                const totalFeedback = feedback.length;
                const avgRating = totalFeedback > 0 
                    ? (feedback.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                    : 0;
                
                const positiveFeedback = totalFeedback > 0
                    ? (feedback.filter(item => item.rating >= 4).length / totalFeedback * 100).toFixed(1)
                    : 0;
                
                const negativeFeedback = totalFeedback > 0
                    ? (feedback.filter(item => item.rating <= 2).length / totalFeedback * 100).toFixed(1)
                    : 0;
                
                // Find most common category
                const categoryCounts = {};
                feedback.forEach(item => {
                    categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
                });
                
                const mostCommonCategory = Object.keys(categoryCounts).reduce((a, b) => 
                    categoryCounts[a] > categoryCounts[b] ? a : b
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${branch}</td>
                    <td>${totalFeedback}</td>
                    <td>${avgRating}</td>
                    <td>${positiveFeedback}%</td>
                    <td>${negativeFeedback}%</td>
                    <td>
                        <span class="feedback-category category-${mostCommonCategory.toLowerCase()}">${mostCommonCategory}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewBranchFeedback('${branch}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update existing categories table
        function updateExistingCategoriesTable() {
            const tbody = document.getElementById('existingCategoriesTable');
            tbody.innerHTML = '';
            
            CONFIG.FEEDBACK_CATEGORIES.forEach(category => {
                const feedback = feedbackData.filter(item => item.category === category);
                const totalFeedback = feedback.length;
                const avgRating = totalFeedback > 0 
                    ? (feedback.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                    : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="feedback-category category-${category.toLowerCase()}">${category}</span>
                    </td>
                    <td>${totalFeedback}</td>
                    <td>${avgRating}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory('${category}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update category performance table
        function updateCategoryPerformanceTable() {
            const tbody = document.getElementById('categoryPerformanceTable');
            tbody.innerHTML = '';
            
            CONFIG.FEEDBACK_CATEGORIES.forEach(category => {
                const feedback = feedbackData.filter(item => item.category === category);
                const totalFeedback = feedback.length;
                const avgRating = totalFeedback > 0 
                    ? (feedback.reduce((sum, item) => sum + item.rating, 0) / totalFeedback).toFixed(1)
                    : 0;
                
                const positiveFeedback = totalFeedback > 0
                    ? (feedback.filter(item => item.rating >= 4).length / totalFeedback * 100).toFixed(1)
                    : 0;
                
                const negativeFeedback = totalFeedback > 0
                    ? (feedback.filter(item => item.rating <= 2).length / totalFeedback * 100).toFixed(1)
                    : 0;
                
                // Calculate trend (simplified)
                const trend = avgRating >= 4 ? 'high' : avgRating >= 3 ? 'medium' : 'low';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="feedback-category category-${category.toLowerCase()}">${category}</span>
                    </td>
                    <td>${totalFeedback}</td>
                    <td>${avgRating}</td>
                    <td>${positiveFeedback}%</td>
                    <td>${negativeFeedback}%</td>
                    <td>
                        <span class="performance-indicator performance-${trend}">${trend}</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update feedback list
        function updateFeedbackList() {
            const container = document.getElementById('feedbackList');
            container.innerHTML = '';
            
            const branchFilter = document.getElementById('feedbackFilterBranch').value;
            const categoryFilter = document.getElementById('feedbackFilterCategory').value;
            const ratingFilter = document.getElementById('feedbackFilterRating').value;
            
            let filteredFeedback = feedbackData;
            
            if (branchFilter !== 'all') {
                filteredFeedback = filteredFeedback.filter(item => item.branch === branchFilter);
            }
            
            if (categoryFilter !== 'all') {
                filteredFeedback = filteredFeedback.filter(item => item.category === categoryFilter);
            }
            
            if (ratingFilter !== 'all') {
                filteredFeedback = filteredFeedback.filter(item => item.rating == ratingFilter);
            }
            
            filteredFeedback.forEach(item => {
                const card = document.createElement('div');
                card.className = 'feedback-list-item';
                card.innerHTML = `
                    <div class="feedback-header">
                        <div>
                            <h6>${item.branch}</h6>
                            <div class="rating-input">
                                ${generateStars(item.rating)}
                            </div>
                        </div>
                        <div>
                            <span class="feedback-category category-${item.category.toLowerCase()}">${item.category}</span>
                            <span class="badge ${item.status === 'Resolved' ? 'bg-success' : item.status === 'In Progress' ? 'bg-warning' : 'bg-secondary'} ms-2">${item.status}</span>
                        </div>
                    </div>
                    <div class="feedback-body">
                        <p>${item.comment}</p>
                    </div>
                    <div class="feedback-footer">
                        <span>${item.date}</span>
                        <div class="feedback-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="editFeedback(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteFeedback(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Edit feedback
        function editFeedback(id) {
            const feedback = feedbackData.find(f => f.id === id);
            if (feedback) {
                document.getElementById('feedbackDate').value = feedback.date;
                document.getElementById('feedbackBranch').value = feedback.branch;
                document.getElementById('feedbackRatingValue').value = feedback.rating;
                updateStarDisplay(feedback.rating);
                document.getElementById('feedbackCategory').value = feedback.category;
                document.getElementById('feedbackComment').value = feedback.comment;
                
                const modal = new bootstrap.Modal(document.getElementById('addFeedbackModal'));
                modal.show();
            }
        }

        // Delete feedback
        function deleteFeedback(id) {
            if (confirm('Are you sure you want to delete this feedback?')) {
                feedbackData = feedbackData.filter(f => f.id !== id);
                updateFeedbackList();
                showNotification('Feedback deleted', 'success');
            }
        }

        // Update star display
        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('#feedbackRating i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // View branch feedback
        function viewBranchFeedback(branch) {
            document.getElementById('feedbackFilterBranch').value = branch;
            updateFeedbackList();
            
            // Switch to feedback list tab
            const feedbackListTab = document.getElementById('feedback-list-tab');
            const feedbackList = new bootstrap.Tab(feedbackListTab);
            feedbackList.show();
        }

        // Delete category
        function deleteCategory(category) {
            if (confirm(`Are you sure you want to delete the "${category}" category?`)) {
                // Update feedback data to use "Other" category
                feedbackData.forEach(item => {
                    if (item.category === category) {
                        item.category = 'Other';
                    }
                });
                
                // Remove from categories array
                const index = CONFIG.FEEDBACK_CATEGORIES.indexOf(category);
                if (index > -1) {
                    CONFIG.FEEDBACK_CATEGORIES.splice(index, 1);
                }
                
                updateExistingCategoriesTable();
                updateCategoryPerformanceTable();
                updateFeedbackList();
                showNotification('Category deleted', 'success');
            }
        }

        // Add category
        document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const categoryName = document.getElementById('newCategoryName').value;
            
            if (CONFIG.FEEDBACK_CATEGORIES.includes(categoryName)) {
                showNotification('Category already exists', 'warning');
                return;
            }
            
            CONFIG.FEEDBACK_CATEGORIES.push(categoryName);
            updateExistingCategoriesTable();
            updateCategoryPerformanceTable();
            
            // Reset form
            document.getElementById('newCategoryName').value = '';
            showNotification('Category added', 'success');
        });

        // Initialize rating input
        document.getElementById('feedbackRating').addEventListener('click', function(e) {
            if (e.target.tagName === 'I') {
                const rating = parseInt(e.target.getAttribute('data-rating'));
                document.getElementById('feedbackRatingValue').value = rating;
                updateStarDisplay(rating);
            }
        });

        // Initialize color picker
        document.getElementById('categoryColorPicker').addEventListener('click', function(e) {
            if (e.target.classList.contains('color-option')) {
                // Remove previous selection
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Add selection to clicked option
                e.target.classList.add('selected');
                selectedCategoryColor = e.target.getAttribute('data-color');
            }
        });

        // Update data table
        function updateDataTable() {
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = '';
            
            salesData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.branch}</td>
                    <td>${item.channel}</td>
                    <td>${item.transactions}</td>
                    <td>${formatCurrency(item.sales)}</td>
                    <td>${formatCurrency(item.averagePerOrder)}</td>
                    <td>
                        <span class="offer-badge offer-${item.offerType.toLowerCase().replace(' ', '-')}">
                            ${item.offerType}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${item.offerStatus}
                        </span>
                    </td>
                    <td>${item.notes}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editSalesRecord(${item.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteSalesRecord(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Edit sales record
        function editSalesRecord(id) {
            const record = salesData.find(item => item.id === id);
            if (record) {
                document.getElementById('dateInput').value = record.date;
                document.getElementById('branchInput').value = record.branch;
                document.getElementById('channelInput').value = record.channel;
                document.getElementById('transactionsInput').value = record.transactions;
                document.getElementById('salesInput').value = record.sales;
                document.getElementById('averageInput').value = record.averagePerOrder;
                document.getElementById('offerTypeInput').value = record.offerType;
                document.getElementById('offerStatusInput').value = record.offerStatus;
                document.getElementById('notesInput').value = record.notes;
                
                // Remove the record from the array (will be updated on save)
                salesData = salesData.filter(item => item.id !== id);
                updateDataTable();
                
                showNotification('Record loaded for editing', 'info');
            }
        }

        // Delete sales record
        function deleteSalesRecord(id) {
            if (confirm('Are you sure you want to delete this sales record?')) {
                salesData = salesData.filter(item => item.id !== id);
                updateDataTable();
                markDataChanged();
                showNotification('Record deleted', 'success');
            }
        }

        // Update feedback table
        function updateFeedbackTable() {
            const tbody = document.getElementById('feedbackTable');
            tbody.innerHTML = '';
            
            feedbackData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.branch}</td>
                    <td>
                        <div class="rating-input">
                            ${generateStars(item.rating)}
                        </div>
                    </td>
                    <td>
                        <span class="feedback-category category-${item.category.toLowerCase()}">${item.category}</span>
                    </td>
                    <td>${item.comment}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editFeedback(${item.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteFeedback(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Save data state for undo functionality
        function saveDataState() {
            const state = {
                salesData: JSON.parse(JSON.stringify(salesData)),
                offers: JSON.parse(JSON.stringify(offers)),
                feedbackData: JSON.parse(JSON.stringify(feedbackData)),
                timestamp: new Date().toISOString()
            };
            
            dataHistory.push(state);
            if (dataHistory.length > MAX_HISTORY_SIZE) {
                dataHistory.shift();
            }
            
            updateUndoStatus();
        }

        // Update undo status
        function updateUndoStatus() {
            const undoStatus = document.getElementById('undoStatus');
            if (dataHistory.length > 0) {
                undoStatus.textContent = `Last action: ${new Date(dataHistory[dataHistory.length - 1].timestamp).toLocaleTimeString()}`;
            } else {
                undoStatus.textContent = 'No actions to undo';
            }
        }

        // Undo last action
        function undoLastAction() {
            if (dataHistory.length === 0) {
                showNotification('No actions to undo', 'warning');
                return;
            }
            
            const previousState = dataHistory.pop();
            salesData = JSON.parse(JSON.stringify(previousState.salesData));
            offers = JSON.parse(JSON.stringify(previousState.offers));
            feedbackData = JSON.parse(JSON.stringify(previousState.feedbackData));
            
            updateDataTable();
            updateFeedbackTable();
            updateDataStats();
            updateLastSavedTime();
            
            updateUndoStatus();
            showNotification('Last action undone', 'success');
        }

        // Initialize charts
        function initializeCharts() {
            // Sales trend chart
            const salesTrendCtx = document.getElementById('salesTrendChart').getContext('2d');
            chartInstances.salesTrend = new Chart(salesTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sales (AED)',
                        data: [],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Sales: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Branch sales chart
            const branchSalesCtx = document.getElementById('branchSalesChart').getContext('2d');
            chartInstances.branchSales = new Chart(branchSalesCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#28a745',
                            '#17a2b8',
                            '#6f42c1',
                            '#dc3545',
                            '#ffc107'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatCurrency(context.parsed)}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Branch performance radar chart
            const branchPerfRadarCtx = document.getElementById('branchPerformanceRadarChart').getContext('2d');
            chartInstances.branchPerformanceRadar = new Chart(branchPerfRadarCtx, {
                type: 'radar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Sales',
                            data: [],
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.2)'
                        },
                        {
                            label: 'Transactions',
                            data: [],
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.2)'
                        },
                        {
                            label: 'Avg Order',
                            data: [],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.2)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Branch performance ranking chart
            const branchPerfRankCtx = document.getElementById('branchPerformanceRankingChart').getContext('2d');
            chartInstances.branchPerformanceRanking = new Chart(branchPerfRankCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Performance Score',
                        data: [],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Daily trends chart
            const dailyTrendsCtx = document.getElementById('dailyTrendsChart').getContext('2d');
            chartInstances.dailyTrends = new Chart(dailyTrendsCtx, {
                type: 'bar',
                data: {
                    labels: CONFIG.DAYS_OF_WEEK,
                    datasets: [
                        {
                            label: 'Sales',
                            data: [],
                            backgroundColor: '#ff6b35'
                        },
                        {
                            label: 'Transactions',
                            data: [],
                            backgroundColor: '#17a2b8'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Weekly trends chart
            const weeklyTrendsCtx = document.getElementById('weeklyTrendsChart').getContext('2d');
            chartInstances.weeklyTrends = new Chart(weeklyTrendsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Sales',
                            data: [],
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Transactions',
                            data: [],
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Moving average chart
            const movingAvgCtx = document.getElementById('movingAverageChart').getContext('2d');
            chartInstances.movingAverage = new Chart(movingAvgCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '7-Day Moving Average',
                        data: [],
                        borderColor: '#f7931e',
                        backgroundColor: 'rgba(247, 147, 30, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Feedback category chart
            const feedbackCategoryCtx = document.getElementById('feedbackCategoryChart').getContext('2d');
            chartInstances.feedbackCategory = new Chart(feedbackCategoryCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#17a2b8',
                            '#ff6b35',
                            '#28a745',
                            '#ffc107'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Rating distribution chart
            const ratingDistCtx = document.getElementById('ratingDistributionChart').getContext('2d');
            chartInstances.ratingDistribution = new Chart(ratingDistCtx, {
                type: 'bar',
                data: {
                    labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                    datasets: [{
                        label: 'Number of Reviews',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Feedback overview category chart
            const feedbackOverviewCategoryCtx = document.getElementById('feedbackOverviewCategoryChart').getContext('2d');
            chartInstances.feedbackOverviewCategory = new Chart(feedbackOverviewCategoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#17a2b8',
                            '#ff6b35',
                            '#28a745',
                            '#ffc107'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Feedback overview rating chart
            const feedbackOverviewRatingCtx = document.getElementById('feedbackOverviewRatingChart').getContext('2d');
            chartInstances.feedbackOverviewRating = new Chart(feedbackOverviewRatingCtx, {
                type: 'bar',
                data: {
                    labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                    datasets: [{
                        label: 'Number of Reviews',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Feedback branch performance chart
            const feedbackBranchPerfCtx = document.getElementById('feedbackBranchPerformanceChart').getContext('2d');
            chartInstances.feedbackBranchPerformance = new Chart(feedbackBranchPerfCtx, {
                type: 'radar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Branch performance chart for management report
            const branchPerfReportCtx = document.getElementById('branchPerformanceChart').getContext('2d');
            chartInstances.branchPerformance = new Chart(branchPerfReportCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sales (AED)',
                        data: [],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Daily weekly performance chart
            const dailyWeeklyPerfCtx = document.getElementById('dailyWeeklyPerformanceChart').getContext('2d');
            chartInstances.dailyWeeklyPerformance = new Chart(dailyWeeklyPerfCtx, {
                type: 'line',
                data: {
                    labels: CONFIG.DAYS_OF_WEEK,
                    datasets: [
                        {
                            label: 'Sales',
                            data: [],
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Transactions',
                            data: [],
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Monthly trend chart
            const monthlyTrendCtx = document.getElementById('monthlyTrendChart').getContext('2d');
            chartInstances.monthlyTrend = new Chart(monthlyTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sales (AED)',
                        data: [],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Target plan chart
            const targetPlanCtx = document.getElementById('targetPlanChart').getContext('2d');
            chartInstances.targetPlan = new Chart(targetPlanCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#28a745',
                            '#17a2b8'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Feedback category report chart
            const feedbackCategoryReportCtx = document.getElementById('feedbackCategoryReportChart').getContext('2d');
            chartInstances.feedbackCategoryReport = new Chart(feedbackCategoryReportCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Number of Reviews',
                        data: [],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Feedback rating report chart
            const feedbackRatingReportCtx = document.getElementById('feedbackRatingReportChart').getContext('2d');
            chartInstances.feedbackRatingReport = new Chart(feedbackRatingReportCtx, {
                type: 'bar',
                data: {
                    labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                    datasets: [{
                        label: 'Number of Reviews',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>${message}</div>
                    <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load saved data
            const dataLoaded = loadData();
            if (!dataLoaded) {
                showNotification('No saved data found. Using sample data.', 'info');
            }
            
            // Initialize auto-save
            initAutoSave();
            
            // Set today's date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            document.getElementById('startDate').value = today;
            
            // Show dashboard by default
            showPage('dashboard');
            
            // Reset offer modal on close
            document.getElementById('addOfferModal').addEventListener('hidden.bs.modal', resetOfferModal);
            
            // Add event listener for save offer button
            document.getElementById('saveOfferButton').addEventListener('click', saveOffer);
            
            // Initialize Excel drag and drop
            initExcelDragAndDrop();
            
            // Initialize charts
            initializeCharts();
        });
    </script>
</body>
</html>
